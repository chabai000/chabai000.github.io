<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>redis | 茶白的博客</title><meta name="author" content="茶白"><meta name="copyright" content="茶白"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. NoSQL的引言NoSQL(Not Only SQL )，意即不仅仅是SQL, 泛指非关系型的数据库。Nosql这个技术门类早期就有人提出，发展至2009年趋势越发高涨。 关系型数据库（RDBMS）：通过SQL语句操作 存储数据 如：MySQL、Oracle等 非关系型数据库：不一定通过SQL语句操作 存储数据 2. 为什么是NoSQL?随着互联网网站的兴起，传统的关系数据库在应付动态网站，">
<meta property="og:type" content="article">
<meta property="og:title" content="redis">
<meta property="og:url" content="https://chabai000.github.io/posts/44296/index.html">
<meta property="og:site_name" content="茶白的博客">
<meta property="og:description" content="1. NoSQL的引言NoSQL(Not Only SQL )，意即不仅仅是SQL, 泛指非关系型的数据库。Nosql这个技术门类早期就有人提出，发展至2009年趋势越发高涨。 关系型数据库（RDBMS）：通过SQL语句操作 存储数据 如：MySQL、Oracle等 非关系型数据库：不一定通过SQL语句操作 存储数据 2. 为什么是NoSQL?随着互联网网站的兴起，传统的关系数据库在应付动态网站，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chabai000.github.io/UpPictures/UpCover/redis.png">
<meta property="article:published_time" content="2022-03-31T13:14:45.000Z">
<meta property="article:modified_time" content="2024-09-05T13:42:46.675Z">
<meta property="article:author" content="茶白">
<meta property="article:tag" content="redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chabai000.github.io/UpPictures/UpCover/redis.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://chabai000.github.io/posts/44296/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 茶白","link":"链接: ","source":"来源: 茶白的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'redis',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-05 21:42:46'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><style type="text/css">.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><meta name="generator" content="Hexo 7.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/UpPictures/UpCover/redis.png')"><nav id="nav"><span id="blog-info"><a href="/" title="茶白的博客"><span class="site-name">茶白的博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">redis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-31T13:14:45.000Z" title="发表于 2022-03-31 21:14:45">2022-03-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-05T13:42:46.675Z" title="更新于 2024-09-05 21:42:46">2024-09-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>81分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="redis"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="1-NoSQL的引言"><a href="#1-NoSQL的引言" class="headerlink" title="1. NoSQL的引言"></a>1. NoSQL的引言</h3><p>NoSQL(Not Only SQL )，意即不仅仅是SQL, 泛指非关系型的数据库。Nosql这个技术门类早期就有人提出，发展至2009年趋势越发高涨。</p>
<p><strong>关系型数据库（RDBMS）</strong>：通过SQL语句操作 存储数据 如：MySQL、Oracle等</p>
<p><strong>非关系型数据库</strong>：不一定通过SQL语句操作 存储数据</p>
<h3 id="2-为什么是NoSQL"><a href="#2-为什么是NoSQL" class="headerlink" title="2. 为什么是NoSQL?"></a>2. 为什么是NoSQL?</h3><p>随着互联网网站的兴起，传统的关系数据库在应付动态网站，特别是超大规模和高并发的纯动态网站已经显得力不从心，暴露了很多难以克服的问题。如商城网站中对商品数据频繁查询（缓存）、对热搜商品的排行统计（统计）、订单超时问题（过期自动超时）、以及微信朋友圈（音频，视频）存储(（存储）等相关使用传统的关系型数据库实现就显得非常复杂，虽然能实现相应功能但是在性能上却不是那么乐观。nosql这个技术门类的出现，更好的解决了这些问题，它告诉了世界不仅仅是sql，提出了对问题的新的解决方案。</p>
<h3 id="3-NoSQL的四大分类"><a href="#3-NoSQL的四大分类" class="headerlink" title="3. NoSQL的四大分类"></a>3. NoSQL的四大分类</h3><h4 id="3-1-键值对-Key-Value-存储数据库"><a href="#3-1-键值对-Key-Value-存储数据库" class="headerlink" title="3.1 键值对(Key-Value)存储数据库"></a>3.1 键值对(Key-Value)存储数据库</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404105739497.png" alt="image-20240404105739497"></p>
<h4 id="3-2-列存储数据库"><a href="#3-2-列存储数据库" class="headerlink" title="3.2 列存储数据库"></a>3.2 列存储数据库</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404105757482.png" alt="image-20240404105757482"></p>
<h4 id="3-3-文档型-Document-数据库"><a href="#3-3-文档型-Document-数据库" class="headerlink" title="3.3 文档型(Document)数据库"></a>3.3 文档型(Document)数据库</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404105813636.png" alt="image-20240404105813636"></p>
<h4 id="3-4-图形-Graph-数据库"><a href="#3-4-图形-Graph-数据库" class="headerlink" title="3.4 图形(Graph)数据库"></a>3.4 图形(Graph)数据库</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404105844769.png" alt="image-20240404105844769"></p>
<h3 id="4-NoSQL应用场景"><a href="#4-NoSQL应用场景" class="headerlink" title="4. NoSQL应用场景"></a>4. NoSQL应用场景</h3><ul>
<li>数据模型比较简单</li>
<li>需要灵活性更强的IT系统（系统设计灵活、性能要求比较高）</li>
<li>对数据库性能要求较高</li>
<li>不需要高度的数据一致性（NoSQL产品对事务支持不是特别良好）</li>
</ul>
<h3 id="5-什么是Redis"><a href="#5-什么是Redis" class="headerlink" title="5. 什么是Redis?"></a>5. 什么是Redis?</h3><p><strong>官网：</strong><a target="_blank" rel="noopener" href="https://redis.io/">Redis</a></p>
<p><strong>中文网站：</strong><a target="_blank" rel="noopener" href="http://www.redis.cn/">CRUG网站</a> ，软件更新速度较慢</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404105923265.png" alt="image-20240404105923265"></p>
<blockquote>
<p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache and message broker.</p>
</blockquote>
<p><strong>新版：</strong> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404105946780.png" alt="image-20240404105946780"></p>
<p><strong>Redis：</strong>开源    遵循BSD    基于内存数据存储    被用于作为数据库、缓存、消息中间件  </p>
<p>redis数据在内存中 内存：读写快 断电立即消失</p>
<p><strong>机制</strong>：持久化机制 定期将内存中数据写入到磁盘（ROM，数据持久化）中，保证数据不丢失</p>
<p><strong>数据库</strong>：硬盘存储数据	—通过io读到内存—操作</p>
<p><strong>总结</strong>：redis是一个内存型的数据库 缓存 消息中间件等</p>
<h3 id="6-Redis特点"><a href="#6-Redis特点" class="headerlink" title="6. Redis特点"></a>6. Redis特点</h3><ul>
<li><p>Redis是一个高性能key&#x2F;value内存型数据库</p>
</li>
<li><p>Redis支持丰富的数据类型（String、List、Set、Zset、Hash），相比于Memcache（字符串，对象） 丰富</p>
</li>
<li><p>Redis支持持久化，可将内存中数据持久化到磁盘中</p>
</li>
<li><p>Redis单进程、单线程，借鉴了Memcache（多线程、线程锁），效率高，不支持并发，不存在线程安全问题（所有请求都是一个一个走）：Redis实现分布式锁</p>
</li>
</ul>
<h3 id="7-Redis安装"><a href="#7-Redis安装" class="headerlink" title="7. Redis安装"></a>7. Redis安装</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404110426973.png" alt="image-20240404110426973"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404110506900.png" alt="image-20240404110506900"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404110540715.png" alt="image-20240404110540715"></p>
<h3 id="8-Redis数据库相关指令"><a href="#8-Redis数据库相关指令" class="headerlink" title="8. Redis数据库相关指令"></a>8. Redis数据库相关指令</h3><h4 id="8-0redis细节"><a href="#8-0redis细节" class="headerlink" title="8.0redis细节"></a>8.0redis细节</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404110640503.png" alt="image-20240404110640503"></p>
<h4 id="8-1-数据库操作指令"><a href="#8-1-数据库操作指令" class="headerlink" title="8.1 数据库操作指令"></a>8.1 数据库操作指令</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.Redis中库说明</span></span><br><span class="line"><span class="bullet">-</span> 使用redis的默认配置器动redis服务后,默认会存在16个库,编号从0-15</span><br><span class="line"><span class="bullet">-</span> 可以使用select 库的编号 来选择一个redis的库</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.Redis中操作库的指令</span></span><br><span class="line"><span class="bullet">-</span> 清空当前的库  FLUSHDB（Tab键提示且自动变大写）</span><br><span class="line"><span class="bullet">-</span> 清空全部的库  FLUSHALL</span><br><span class="line"></span><br><span class="line"><span class="section"># 3.redis客户端显示中文</span></span><br><span class="line"><span class="bullet">-</span>   ./redis-cli  -p 7000 --raw</span><br></pre></td></tr></table></figure>

<h4 id="8-2-操作key相关指令"><a href="#8-2-操作key相关指令" class="headerlink" title="8.2 操作key相关指令"></a>8.2 操作key相关指令</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.DEL指令</span></span><br><span class="line"><span class="bullet">-</span> 语法 :  DEL key [key ...] </span><br><span class="line"><span class="bullet">-</span> 作用 :  删除给定的一个或多个key 。不存在的key 会被忽略。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 1.0.0</span><br><span class="line"><span class="bullet">-</span> 返回值： 被删除key 的数量。 </span><br><span class="line"><span class="bullet">-</span> 举例：del name</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.EXISTS指令</span></span><br><span class="line"><span class="bullet">-</span> 语法:  EXISTS key</span><br><span class="line"><span class="bullet">-</span> 作用:  检查给定key 是否存在。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 1.0.0</span><br><span class="line"><span class="bullet">-</span> 返回值： 若key 存在，返回1 ，否则返回0。</span><br><span class="line"><span class="bullet">-</span> 举例：exists name，存在返回1，不存在返回0</span><br><span class="line"><span class="bullet">-</span>       exists name age bir,存在几个返回几，都不存在返回0（key可指定多个）</span><br><span class="line"></span><br><span class="line"><span class="section"># 3.EXPIRE指令（解决超时问题）</span></span><br><span class="line"><span class="bullet">-</span> 语法:  EXPIRE key seconds</span><br><span class="line"><span class="bullet">-</span> 作用:  为给定key 设置生存时间，当key 过期时(生存时间为0 )，它会被自动删除。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 1.0.0</span><br><span class="line"><span class="bullet">-</span> 时间复杂度： O(1)</span><br><span class="line"><span class="bullet">-</span> 返回值：设置成功返回1 。</span><br><span class="line"><span class="bullet">-</span> 举例：expire name 10，设置name的有效期为10秒</span><br><span class="line"></span><br><span class="line"><span class="section"># 4.KEYS</span></span><br><span class="line"><span class="bullet">-</span> 语法 :  KEYS pattern</span><br><span class="line"><span class="bullet">-</span> 作用 :  查找所有符合给定模式pattern的key 。</span><br><span class="line"><span class="bullet">-</span> 语法:</span><br><span class="line"><span class="code">    KEYS *：匹配数据库中所有key 。</span></span><br><span class="line"><span class="code">    KEYS h?llo：？表示匹配一个字符，匹配hello ，hallo 和hxllo等。</span></span><br><span class="line"><span class="code">    KEYS h*llo：*表示匹配0到任意多个字符，匹配hllo 和heeeeello 等。</span></span><br><span class="line"><span class="code">    KEYS h[ae]llo ：[]表示匹配一个，匹配a或者e，匹配hello 和hallo ，但不匹配hillo 。特殊符号用 &quot;\&quot; 隔开</span></span><br><span class="line"><span class="code">- 可用版本： &gt;= 1.0.0</span></span><br><span class="line"><span class="code">- 返回值： 符合给定模式的key 列表。</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 5.MOVE</span></span><br><span class="line"><span class="bullet">-</span> 语法 :  MOVE key db</span><br><span class="line"><span class="bullet">-</span> 作用 :  将当前数据库的key 移动到给定的数据库db当中。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 1.0.0</span><br><span class="line"><span class="bullet">-</span> 返回值： 移动成功返回1 ，失败则返回0。</span><br><span class="line"><span class="bullet">-</span> 举例：move name 1,将key对应name的键值对移到1号库</span><br><span class="line"></span><br><span class="line"><span class="section"># 6.PEXPIRE</span></span><br><span class="line"><span class="bullet">-</span> 语法 :  PEXPIRE key milliseconds</span><br><span class="line"><span class="bullet">-</span> 作用 :  这个命令和EXPIRE命令的作用类似，但是它以毫秒为单位设置key的生存时间，而不像EXPIRE命令那样，以秒为单位。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 2.6.0</span><br><span class="line"><span class="bullet">-</span> 时间复杂度： O(1)</span><br><span class="line"><span class="bullet">-</span> 返回值：设置成功，返回1；key不存在或设置失败，返回0</span><br><span class="line"><span class="bullet">-</span> 举例：pexpire name 10</span><br><span class="line"></span><br><span class="line"><span class="section"># 7.PEXPIREAT</span></span><br><span class="line"><span class="bullet">-</span> 语法 :  PEXPIREAT key milliseconds-timestamp</span><br><span class="line"><span class="bullet">-</span> 作用 :  这个命令和EXPIREAT命令类似，但它以毫秒为单位设置key的过期unix时间戳，而不是像EXPIREAT那样，以秒为单位。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 2.6.0</span><br><span class="line"><span class="bullet">-</span> 返回值：如果生存时间设置成功，返回1。当key不存在或没办法设置生存时间时，返回0。(查看EXPIRE命令获取更多信息)</span><br><span class="line"><span class="bullet">-</span> 举例：pexpireat name 5000，设置name的有效期为5000毫秒，即5秒</span><br><span class="line"></span><br><span class="line"><span class="section"># 8.TTL</span></span><br><span class="line"><span class="bullet">-</span> 语法 :   TTL key</span><br><span class="line"><span class="bullet">-</span> 作用 :   以秒为单位，返回给定key的剩余生存时间(TTL, time to live)。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 1.0.0</span><br><span class="line"><span class="bullet">-</span> 返回值：</span><br><span class="line"><span class="code">    当key不存在时，返回-2 。</span></span><br><span class="line"><span class="code">    当key存在但没有设置剩余生存时间时（永久存储），返回-1。</span></span><br><span class="line"><span class="code">    否则，返回&gt;=0的数，以秒为单位，返回key的剩余生存时间。</span></span><br><span class="line"><span class="code">- Note : 在Redis 2.8以前，当key不存在，或者key没有设置剩余生存时间时，命令都返回-1。</span></span><br><span class="line"><span class="code">- 举例：ttl name</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 9.PTTL</span></span><br><span class="line"><span class="bullet">-</span> 语法 :  PTTL key</span><br><span class="line"><span class="bullet">-</span> 作用 :  这个命令类似于TTL命令，但它以毫秒为单位返回key的剩余生存时间，而不是像TTL命令那样，以秒为单位。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 2.6.0</span><br><span class="line"><span class="bullet">-</span> 返回值： 当key 不存在时，返回-2 。当key存在但没有设置剩余生存时间时，返回-1。</span><br><span class="line"><span class="bullet">-</span> 否则，以毫秒为单位，返回key 的剩余生存时间。</span><br><span class="line"><span class="bullet">-</span> 注意 : 在Redis 2.8以前，当key不存在，或者key没有设置剩余生存时间时，命令都返回-1。</span><br><span class="line"><span class="bullet">-</span> 举例：ttl name</span><br><span class="line"></span><br><span class="line"><span class="section"># 10.RANDOMKEY</span></span><br><span class="line"><span class="bullet">-</span> 语法 :  RANDOMKEY</span><br><span class="line"><span class="bullet">-</span> 作用 :  从当前数据库中随机返回(不删除) 一个key 。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 1.0.0</span><br><span class="line"><span class="bullet">-</span> 返回值：当数据库不为空时，返回一个key 。当数据库为空时，返回nil。</span><br><span class="line"><span class="bullet">-</span> 举例：randomkey name，随机返回一个key</span><br><span class="line"></span><br><span class="line"><span class="section"># 11.RENAME</span></span><br><span class="line"><span class="bullet">-</span> 语法 :  RENAME key newkey</span><br><span class="line"><span class="bullet">-</span> 作用 :  将key改名为newkey。当key和newkey相同，或者key不存在时，返回一个错误。当newkey已经存在时，RENAME命令将覆盖旧值。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 1.0.0</span><br><span class="line"><span class="bullet">-</span> 返回值： 改名成功时提示OK，失败时候返回一个错误。</span><br><span class="line"><span class="bullet">-</span> 举例：rename name username</span><br><span class="line"></span><br><span class="line"><span class="section"># 12.TYPE</span></span><br><span class="line"><span class="bullet">-</span> 语法 :  TYPE key</span><br><span class="line"><span class="bullet">-</span> 作用 :  返回key所储存的值的类型。</span><br><span class="line"><span class="bullet">-</span> 可用版本： &gt;= 1.0.0</span><br><span class="line"><span class="bullet">-</span> 返回值：</span><br><span class="line"><span class="code">    none (key 不存在)</span></span><br><span class="line"><span class="code">    string (字符串)</span></span><br><span class="line"><span class="code">    list (列表)</span></span><br><span class="line"><span class="code">    set (集合)</span></span><br><span class="line"><span class="code">    zset (有序集)</span></span><br><span class="line"><span class="code">    hash (哈希表)</span></span><br><span class="line"><span class="code">- 举例：type name</span></span><br></pre></td></tr></table></figure>

<hr>
<p>上边讲的是&lt;key,value&gt; 的key</p>
<p>下边就要讲&lt;key,value&gt;的value  value[String,list,zset,set,hash] value的类型可以有很多</p>
<hr>
<h4 id="8-3-String类型"><a href="#8-3-String类型" class="headerlink" title="8.3 String类型"></a>8.3 String类型</h4><h5 id="8-3-1-内存存储模型"><a href="#8-3-1-内存存储模型" class="headerlink" title="8.3.1 内存存储模型"></a>8.3.1 内存存储模型</h5><p>key:字符串  value:String字符串</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404141842053.png" alt="image-20240404141842053"></p>
<h5 id="8-3-2-常用操作命令"><a href="#8-3-2-常用操作命令" class="headerlink" title="8.3.2 常用操作命令"></a>8.3.2 常用操作命令</h5><table>
<thead>
<tr>
<th><strong>命令</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>set 键名 值</td>
<td>设置一个key&#x2F;value</td>
</tr>
<tr>
<td>get 键名</td>
<td>根据key获得对应的value</td>
</tr>
<tr>
<td>mset(more set) 键名1 值1 键名2 值2 键名3 值3</td>
<td>一次设置多个key value</td>
</tr>
<tr>
<td>mget(more get) 键名1 键名2 键名3</td>
<td>一次获得多个key的value</td>
</tr>
<tr>
<td>getset 键名  新值</td>
<td>获得原始key的值，同时设置新值</td>
</tr>
<tr>
<td>strlen 键名</td>
<td>获得对应key存储value的长度</td>
</tr>
<tr>
<td>append 键名 值追加内容</td>
<td>为对应key的value追加内容</td>
</tr>
<tr>
<td>getrange（索引从0开始，最后索引可用-1代替） 键名 起点 终点</td>
<td>截取指定范围value的内容</td>
</tr>
<tr>
<td>setex 键名 存活时间(秒) 值；ttl 键名（查看存活时间）</td>
<td>设置一个key存活的有效期（秒）</td>
</tr>
<tr>
<td>psetex键名 存活时间(毫秒) 值；pttl 键名（查看存活时间）</td>
<td>设置一个key存活的有效期（毫秒）</td>
</tr>
<tr>
<td>setnx（set not exists）键名 值</td>
<td>键存在，不做任何操作；键不存在，执行添加操作</td>
</tr>
<tr>
<td>msetnx(原子操作：只要有一个存在不做任何操作，要都不存在才执行) 键名1 值1 键名2 值2 键名3 值3</td>
<td>可以同时设置多个key，只要有一个存在就不做任何处理</td>
</tr>
<tr>
<td>decr 键名</td>
<td>进行数值类型的-1操作</td>
</tr>
<tr>
<td>decrby 键名 步长</td>
<td>根据提供的数据进行减法操作</td>
</tr>
<tr>
<td>incr 键名</td>
<td>进行数值类型的+1操作</td>
</tr>
<tr>
<td>incrby 键名 步长</td>
<td>根据提供的数据进行加法操作</td>
</tr>
<tr>
<td>Incrbyfloat 键名 小数步长（精度保留17位）</td>
<td>根据提供的数据加入浮点数</td>
</tr>
</tbody></table>
<h4 id="8-4-List类型"><a href="#8-4-List类型" class="headerlink" title="8.4 List类型"></a>8.4 List类型</h4><p><strong>list：</strong>列表，相当于java中list 集合</p>
<p><strong>特点：</strong>元素有序且可以重复</p>
<h5 id="8-4-1-内存存储模型"><a href="#8-4-1-内存存储模型" class="headerlink" title="8.4.1 内存存储模型"></a>8.4.1 内存存储模型</h5><p>key：字符串 value:list相当于java中list 集合</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404142538945.png" alt="image-20240404142538945"></p>
<h5 id="8-4-2-常用操作指令"><a href="#8-4-2-常用操作指令" class="headerlink" title="8.4.2 常用操作指令"></a>8.4.2 常用操作指令</h5><table>
<thead>
<tr>
<th><strong>命令</strong></th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>lpush 列表名 值1 值2 值3（从左侧放）</td>
<td>将某个值加入到一个key列表头部</td>
</tr>
<tr>
<td>lpushx（lpush exists） 列表名 值1 值2 值3（从左侧放）</td>
<td>同lpush，但是必须要保证这个key存在（不能创建列表，列表已经被创建时才能使用）</td>
</tr>
<tr>
<td>rpush 列表名 值1 值2 值3（从右侧放）</td>
<td>将某个值加入到一个key列表末尾</td>
</tr>
<tr>
<td>rpushx（rpush exists） 列表名 值1 值2 值3（从右侧放）</td>
<td>同rpush，但是必须要保证这个key存在（不能创建列表，列表已经被创建时才能使用）</td>
</tr>
<tr>
<td>lpop 列表名</td>
<td>返回和移除列表左边的第一个元素</td>
</tr>
<tr>
<td>rpop 列表名</td>
<td>返回和移除列表右边的第一个元素</td>
</tr>
<tr>
<td>lrange 列表名 起点（从0开始） 终点（-1表示末尾） 【遍历时：0 -1】</td>
<td>获取某一个下标区间内的元素</td>
</tr>
<tr>
<td>llen 列表名</td>
<td>获取列表元素个数</td>
</tr>
<tr>
<td>lset 列表名 索引 值</td>
<td>设置某一个指定索引的值(索引必须存在)</td>
</tr>
<tr>
<td>lindex 列表名 索引</td>
<td>获取某一个指定索引位置的元素</td>
</tr>
<tr>
<td>lrem 列表名 重复元素个数 值（从左侧开始匹配，重复时删除）</td>
<td>删除重复元素</td>
</tr>
<tr>
<td>ltrim 列表名 索引起点 索引终点（索引从0开始）</td>
<td>保留列表中特定区间内的元素</td>
</tr>
<tr>
<td>linsert 列表名 before&#x2F;after 值 新值</td>
<td>在某一个元素之前&#x2F;之后插入新元素</td>
</tr>
</tbody></table>
<h4 id="8-5-Set类型"><a href="#8-5-Set类型" class="headerlink" title="8.5 Set类型"></a>8.5 Set类型</h4><p><strong>特点：</strong>Set类型 Set集合 元素无序 不可以重复</p>
<h5 id="8-5-1-内存存储模型"><a href="#8-5-1-内存存储模型" class="headerlink" title="8.5.1 内存存储模型"></a>8.5.1 内存存储模型</h5><p>key：字符串 value: set集合</p>
<p>一键（String）对多值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404142806270.png" alt="image-20240404142806270"></p>
<h5 id="8-5-2-常用命令"><a href="#8-5-2-常用命令" class="headerlink" title="8.5.2 常用命令"></a>8.5.2 常用命令</h5><table>
<thead>
<tr>
<th><strong>命令</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>sadd 键名 值1 值2 值</td>
<td>没有集合时会先创建集合，然后为集合添加元素</td>
</tr>
<tr>
<td>smembers 键名</td>
<td>显示集合中所有元素，无序</td>
</tr>
<tr>
<td>scard 键名</td>
<td>返回集合中元素的个数</td>
</tr>
<tr>
<td>spop 键名</td>
<td>随机返回一个元素，并将元素在集合中删除</td>
</tr>
<tr>
<td>smove 键名1 键名2 值</td>
<td>从一个集合中向另一个集合移动元素，必须是同一种类型</td>
</tr>
<tr>
<td>srem 键名 值</td>
<td>从集合中删除一个元素</td>
</tr>
<tr>
<td>sismember 键名 值</td>
<td>判断一个集合中是否含有这个元素，有就返回1，没有返回0</td>
</tr>
<tr>
<td>srandmember 键名 元素个数</td>
<td>随机返回元素，不删除</td>
</tr>
<tr>
<td>sdiff 键名1 键名2 键名3 …</td>
<td>去掉第一个集合中其它集合含有的相同元素</td>
</tr>
<tr>
<td>sinter 键名1 键名2 键名3 …</td>
<td>求交集(去重)</td>
</tr>
<tr>
<td>sunion 键名1 键名2 键名3 …</td>
<td>求和集</td>
</tr>
</tbody></table>
<h4 id="8-6-ZSet类型"><a href="#8-6-ZSet类型" class="headerlink" title="8.6 ZSet类型"></a>8.6 ZSet类型</h4><p><strong>特点:</strong> 可排序的set集合 排序 不可重复</p>
<p>ZSET 官方 | 可排序SET sortSet</p>
<h5 id="8-6-1-内存模型"><a href="#8-6-1-内存模型" class="headerlink" title="8.6.1 内存模型"></a>8.6.1 内存模型</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404143015532.png" alt="image-20240404143015532"></p>
<h5 id="8-6-2-常用命令"><a href="#8-6-2-常用命令" class="headerlink" title="8.6.2 常用命令"></a>8.6.2 常用命令</h5><table>
<thead>
<tr>
<th><strong>命令</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>zadd 键名 分数1 值1 分数2 值2 分数3 值3</td>
<td>没有集合时创建集合，然后添加集合元素，元素有序且不重复</td>
</tr>
<tr>
<td>zcard 键名</td>
<td>返回集合的元素个数</td>
</tr>
<tr>
<td>zrange(升序)&#x2F;zrevrange(降序 ) 键名 下标起点 下标终点 (withscores 带此参数时显示分数)</td>
<td>返回一个范围内的元素</td>
</tr>
<tr>
<td>zrangebyscore 键名 分数起点 分数终点 withscores limit 页码 显示条数</td>
<td>按照分数查找一个范围内的元素</td>
</tr>
<tr>
<td>zrank 键名 值</td>
<td>返回排名（正序）</td>
</tr>
<tr>
<td>zrevrank 键名 值</td>
<td>倒序排名</td>
</tr>
<tr>
<td>zscore 键名 值</td>
<td>显示某一个元素的分数</td>
</tr>
<tr>
<td>zrem 键名 值1 值2 值3……..</td>
<td>移除某一个或多个元素</td>
</tr>
<tr>
<td>zincrby 键名 加分值 值</td>
<td>给某个特定元素加分</td>
</tr>
</tbody></table>
<h4 id="8-7-hash类型"><a href="#8-7-hash类型" class="headerlink" title="8.7 hash类型"></a>8.7 hash类型</h4><p><strong>redis ：</strong>key（string）、value（map）</p>
<p><strong>特点:</strong> value是一个map结构，存在key、value，且key是无序的</p>
<p><strong>即：[ 外key, [ 内key , 内value ] ]</strong>   先写外key再内key最后内value</p>
<h5 id="8-7-1-内存模型"><a href="#8-7-1-内存模型" class="headerlink" title="8.7.1 内存模型"></a>8.7.1 内存模型</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404143200682.png" alt="image-20240404143200682"></p>
<h5 id="8-7-2-常用命令"><a href="#8-7-2-常用命令" class="headerlink" title="8.7.2 常用命令"></a>8.7.2 常用命令</h5><table>
<thead>
<tr>
<th><strong>命令</strong></th>
<th><strong>命令</strong></th>
</tr>
</thead>
<tbody><tr>
<td>hset 外key 内key 内value</td>
<td>设置一个key&#x2F;value对</td>
</tr>
<tr>
<td>hget 外key 内key</td>
<td>获得一个key对应的value</td>
</tr>
<tr>
<td>hgetall 外key</td>
<td>获得所有的key&#x2F;value对</td>
</tr>
<tr>
<td>hdel 外key 内key</td>
<td>删除某一个key&#x2F;value对</td>
</tr>
<tr>
<td>hexists 外key 内key</td>
<td>判断一个key是否存在</td>
</tr>
<tr>
<td>hkeys 外key</td>
<td>获得所有的key</td>
</tr>
<tr>
<td>hvals 外key</td>
<td>获得所有的value</td>
</tr>
<tr>
<td>hmset 外key 内key1 内value1 内key2 内value2……</td>
<td>设置多个key&#x2F;value</td>
</tr>
<tr>
<td>hmget 外key 内key1 内key2 ……</td>
<td>获得多个key的value</td>
</tr>
<tr>
<td>hsetnx 外key 新内key 新内value</td>
<td>设置一个不存在的key的值，内key不存在时添加，存在时不添加</td>
</tr>
<tr>
<td>hincrby 外key 内key 增量</td>
<td>为value进行加法运算，value必须为数值类型才可以</td>
</tr>
<tr>
<td>hincrbyfloat 外key 内key 增量</td>
<td>为value加入浮点值，value必须为数值类型才可以</td>
</tr>
</tbody></table>
<h3 id="9-redis桌面可视化工具"><a href="#9-redis桌面可视化工具" class="headerlink" title="9. redis桌面可视化工具"></a>9. redis桌面可视化工具</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404143453873.png" alt="image-20240404143453873"></p>
<p><strong>RedisDesktopManager（自行安装，下一步）：</strong> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404143514902.png" alt="image-20240404143514902"></p>
<p><strong>ok即可，进行连接redis服务器</strong> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404143536853.png" alt="image-20240404143536853"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404143555515.png" alt="image-20240404143555515"></p>
<p><strong>双击进行查看，按照文字进行操作：</strong> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404143626897.png" alt="image-20240404143626897"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404143640311.png" alt="image-20240404143640311"></p>
<h3 id="9-持久化机制"><a href="#9-持久化机制" class="headerlink" title="9.持久化机制"></a>9.持久化机制</h3><p>client redis[内存] —–&gt; 内存数据—数据持久化–&gt;磁盘，即：内存 to 硬盘</p>
<p><strong>Redis官方提供了两种不同的持久化方法来将数据存储到硬盘里面分别是:</strong></p>
<ul>
<li><p><strong>快照(Snapshot) &#x2F; RDB</strong></p>
</li>
<li><p><strong>AOF (Append Only File) 只追加日志文件</strong></p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404144615015.png" alt="image-20240404144615015"></p>
<h4 id="9-1快照-Snapshot-RDB"><a href="#9-1快照-Snapshot-RDB" class="headerlink" title="9.1快照(Snapshot)&#x2F;RDB"></a>9.1快照(Snapshot)&#x2F;RDB</h4><p><strong>9.1.1 特点</strong></p>
<p>​    这种方式可以将某一时刻的所有数据都写入硬盘中，当然这也是<strong>redis默认开启的持久化方式</strong>，保存的文件是<strong>以.rdb形式结尾的文件</strong>，因此这种方式也称之为<strong>RDB方式</strong>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404144709855.png" alt="image-20240404144709855"></p>
<p><strong>9.1.2 快照生成方式</strong></p>
<ul>
<li><strong>客户端方式：BGSAVE 和 SAVE指令</strong></li>
<li><strong>服务器配置自动触发</strong></li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.客户端方式之BGSAVE</span></span><br><span class="line"><span class="bullet">-</span> a.客户端可以使用BGSAVE命令来创建一个快照，当接收到客户端的BGSAVE命令时，redis会调用fork来创建一个子进程，然后子进程负责将快照写入磁盘中，而父进程则继续处理命令请求。</span><br><span class="line"><span class="code">    </span></span><br><span class="line"><span class="code">   fork：当一个进程创建子进程的时候，底层的操作系统会创建该进程的一个副本，在类unix系统中创建子进程的操作会进行优化：在刚开始的时候，父子进程共享相同内存，直到父进程或子进程对内存进行了写之后，对被写入的内存的共享才会结束服务（不会阻塞Redis服务，同时还能保证快照的创建）。</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404144853573.png" alt="image-20240404144853573"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 2.客户端方式之SAVE</span></span><br><span class="line"><span class="bullet">-</span> b.客户端还可以使用SAVE命令来创建一个快照，接收到SAVE命令的redis服务器在快照创建完毕之前，将不再响应任何其他的命令</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404144903842.png" alt="image-20240404144903842"></p>
<p>   <strong>注意：</strong>SAVE命令并不常用，使用SAVE命令在快照创建完毕之前，redis处于阻塞状态，无法对外服务。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 3.服务器配置方式之满足配置自动触发</span></span><br><span class="line"><span class="bullet"> -</span> 如果用户在redis.conf中设置了save配置选项，redis会在save选项条件满足之后自动触发一次BGSAVE命令，如果设置多个save配置选项，当任意一个save配置选项条件满足，redis也会触发一次BGSAVE命令。</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404144919164.png" alt="image-20240404144919164"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 4.服务器接收客户端shutdown指令</span></span><br><span class="line"><span class="bullet"> -</span> 当redis通过shutdown指令接收到关闭服务器的请求时，会执行一个save命令，阻塞所有的客户端，不再执行客户端执行发送的任何命令，并且在save命令执行完毕之后关闭服务器。</span><br></pre></td></tr></table></figure>

<p><strong>9.1.3 配置生成快照名称和位置</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 1.修改生成快照名称</span><br><span class="line">- dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"># 2.修改生成位置</span><br><span class="line">- dir ./</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404145010235.png" alt="image-20240404145010235"></p>
<p><strong>总结：RDB持久化（记录数据）只能保存某一时刻的数据，如果在下一次保存时间还未到来前出现宕机等情况，就会导致该时刻后的数据丢失，为此提出了AOF持久化。</strong></p>
<h4 id="9-2-只追加日志文件-AOF"><a href="#9-2-只追加日志文件-AOF" class="headerlink" title="9.2 只追加日志文件(AOF)"></a>9.2 只追加日志文件(AOF)</h4><p><strong>9.2.1 特点</strong></p>
<p>​		这种方式可以将所有客户端执行的写命令记录到日志文件中，AOF持久化会将被执行的写命令写到AOF的文件末尾，以此来记录数据发生的变化，因此只要redis从头到尾执行一次AOF文件所包含的所有写命令，就可以恢复AOF文件的记录的数据集（可做到丢失1秒数据甚至不丢失数据，记录写命令，以日志的形式保存到aof文件中，数据状态为二进制）。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404145104856.png" alt="image-20240404145104856"></p>
<p><strong>9.2.2 开启AOF持久化</strong></p>
<p>在redis的默认配置中AOF持久化机制是没有开启的，需要在配置中开启：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 1.开启AOF持久化</span><br><span class="line">- a.修改 appendonly yes 开启持久化（默认为no）</span><br><span class="line">- b.修改 appendfilename &quot;appendonly.aof&quot; 指定生成文件名称（默认名称为appendonly.aof）</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404145209983.png" alt="image-20240404145209983"></p>
<p><strong>9.2.3 日志同步频率修改</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 1.修改日志同步频率（默认每秒写入）</span><br><span class="line">- 修改appendfsync everysec|always|no 指定</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404145252695.png" alt="image-20240404145252695"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 1.always 【谨慎使用】</span><br><span class="line">- 说明: 每个redis写命令都要同步写入硬盘,严重降低redis速度</span><br><span class="line">- 解释: 如果用户使用了always选项，那么每个redis写命令都会被写入硬盘，从而将发生系统崩溃时出现的数据丢失减到最少；遗憾的是，因为这种同步策略需要对硬盘进行大量的写入操作，所以redis处理命令的速度会受到硬盘性能的限制；</span><br><span class="line">- 注意: 转盘式硬盘在这种频率下200~500左右个命令/s ; 固态硬盘(SSD)几百万个命令/s;</span><br><span class="line">- 警告: 使用SSD用户请谨慎使用always选项，这种模式不断写入少量数据的做法有可能会引发严重的写入放大问题，导致将固态硬盘的寿命从原来的几年降低为几个月。</span><br><span class="line"></span><br><span class="line"># 2.everysec 【推荐】</span><br><span class="line">- 说明: 每秒执行一次同步显式的将多个写命令同步到磁盘</span><br><span class="line">- 解释：为了兼顾数据安全和写入性能，用户可以考虑使用everysec选项，让redis每秒一次的频率对AOF文件进行同步；redis每秒同步一次AOF文件时性能和不使用任何持久化特性时的性能相差无几，而通过每秒同步一次AOF文件，redis可以保证，即使系统崩溃，用户最多丢失一秒之内产生的数据。</span><br><span class="line"></span><br><span class="line"># 3.no  【不推荐】</span><br><span class="line">- 说明: 由操作系统决定何时同步 </span><br><span class="line">- 解释：最后使用no选项，将完全由操作系统决定什么时候同步AOF日志文件，这个选项不会对redis性能带来影响，但是系统崩溃时，会丢失不定数量的数据，甚至全部数据；另外，如果用户硬盘处理写入操作不够快的话，当缓冲区被等待写入硬盘数据填满时（一次需要大量写入aof，磁盘处理不过来），redis会处于阻塞状态，并导致redis的处理命令请求的速度变慢。</span><br><span class="line"> 总结：持久化机制默认优先执行AOF（数据丢失少，可通过不执行SAVE或BGSAVE来停止RDB持久化），且AOF和RDB可同时生效。</span><br></pre></td></tr></table></figure>

<p><strong>9.2.4 AOF文件的重写</strong></p>
<ol>
<li><p>AOF带来的问题</p>
<p> AOF的方式也同时带来了另一个问题：持久化文件会变的越来越大，例如我们调用incr test命令100次，文件中必须保存全部的100条命令，其实有99条都是多余的，因为要恢复数据库的状态其实文件中保存一条set test 100就够了。为了压缩aof的持久化文件Redis提供了AOF重写(ReWriter)机制。</p>
</li>
<li><p>AOF重写</p>
<p>用来在一定程度上减小AOF文件的体积</p>
</li>
<li><p>触发重写方式</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.客户端方式触发重写</span></span><br><span class="line"><span class="bullet">-</span> 执行BGREWRITEAOF命令  不会阻塞redis的服务</span><br><span class="line"></span><br><span class="line"><span class="section"># 2.服务器配置方式自动触发</span></span><br><span class="line"><span class="bullet">-</span> 配置redis.conf中的auto-aof-rewrite-percentage选项 参加下图↓↓↓</span><br><span class="line"><span class="bullet">-</span> 如果设置auto-aof-rewrite-percentage值为100和auto-aof-rewrite-min-size 64mb，并且启用的AOF持久化时，那么当AOF文件体积大于64M，并且AOF文件的体积比上一次重写之后体积大了至少一倍(100%)时，会自动触发，如果重写过于频繁，用户可以考虑将auto-aof-rewrite-percentage设置为更大（100：1倍、200:2倍......）。</span><br><span class="line"></span><br><span class="line">64MB---》20MB---》40MB---》18MB---》36MB---》26MB---》52MB</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404145507863.png" alt="image-20240404145507863"></p>
</li>
<li><p>重写原理（文件的替换）</p>
<p>   <strong>注意</strong>：重写aof文件的操作，并没有读取旧的aof文件，而是将整个内存中的数据库内容用命令的方式重写了一个新的aof文件，替换原有的文件这点和快照有点类似。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 重写流程</span></span><br><span class="line"><span class="bullet">-</span> 1. redis调用fork，现在有父子两个进程，子进程根据内存中的数据状态写入数据库快照，往临时文件中写入重建数据库状态的命令。</span><br><span class="line"><span class="bullet">-</span> 2. 父进程继续处理client请求，除了把写命令写入到原来的aof文件中。同时把收到的写命令缓存起来，这样就能保证如果子进程重写失败的话并不会出问题。</span><br><span class="line"><span class="bullet">-</span> 3. 当子进程把快照内容写入已命令方式写到临时文件中后，子进程发信号通知父进程，然后父进程把缓存的写命令也写入到临时文件。</span><br><span class="line"><span class="bullet">-</span> 4. 现在父进程可以使用临时文件替换老的aof文件，并重命名，后面收到的写命令也开始往新的aof文件中追加。</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404145609748.png" alt="image-20240404145609748"></p>
</li>
</ol>
<h4 id="9-3-持久化总结"><a href="#9-3-持久化总结" class="headerlink" title="9.3 持久化总结"></a>9.3 持久化总结</h4><p>​		两种持久化方案既可以同时使用(aof)，又可以单独使用，在某种情况下也可以都不使用，具体使用那种持久化方案取决于用户的数据和应用决定。</p>
<p>​	无论使用AOF还是快照机制持久化，将数据持久化到硬盘都是有必要的，除了持久化之外，用户还应该对持久化的文件备份（最好备份在多个不同地方）</p>
<h3 id="10-java操作redis"><a href="#10-java操作redis" class="headerlink" title="10.java操作redis"></a>10.java操作redis</h3><p><strong>9.1 环境准备</strong></p>
<p> 新建普通的java maven项目，archetype选择quickstart，main下新建resources目录。</p>
<p><strong>9.1.1 引入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入redis连接依赖jedis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>9.1.2 创建jedis对象测试redis连接及库相关操作ApI333</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> TestRedis</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 测试Redis连接</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/9/11 13:31</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRedis</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建jedis客户端对象</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>();<span class="comment">// 不指定时使用本机地址，端口号默认为6379</span></span><br><span class="line">        <span class="comment">//Jedis jedis = new Jedis(&quot;192.168.1.7&quot;,6379);//redis服务必须关闭防火墙  redis服务必须开启远程连接</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 选择库，默认使用0号库</span></span><br><span class="line">        jedis.select(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取redis中所有key信息</span></span><br><span class="line">        Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        keys.forEach(key-&gt; System.out.println(<span class="string">&quot;key = &quot;</span> + key));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、操作相关</span></span><br><span class="line">        <span class="comment">// 1.清空当前库</span></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        <span class="comment">// 2.清空所有库</span></span><br><span class="line">        jedis.flushAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、释放资源</span></span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li>redis服务必须关闭防火墙</li>
<li>redis服务必须开启远程连接</li>
</ul>
<p><strong>未启动redis-server.exe（开启远程连接）时报错：</strong></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; redis.clients.jedis.exceptions.JedisConnectionException: java.net.SocketTimeoutException: connect timed out</span><br><span class="line">     at redis.clients.jedis.Connection.connect(Connection.java:207)</span><br><span class="line">     at redis.clients.jedis.BinaryClient.connect(BinaryClient.java:93)</span><br><span class="line">     at redis.clients.jedis.Connection.sendCommand(Connection.java:126)</span><br><span class="line">     at redis.clients.jedis.BinaryClient.select(BinaryClient.java:176)</span><br><span class="line">     at redis.clients.jedis.BinaryJedis.select(BinaryJedis.java:522)</span><br><span class="line">     at com.study.test.TestRedis.main(TestRedis.java:21)</span><br><span class="line"> Caused by: java.net.SocketTimeoutException: connect timed out</span><br><span class="line">     at java.net.DualStackPlainSocketImpl.waitForConnect(Native Method)</span><br><span class="line">     at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:81)</span><br><span class="line">     at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:476)</span><br><span class="line">     at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:218)</span><br><span class="line">     at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:200)</span><br><span class="line">     at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:162)</span><br><span class="line">     at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:394)</span><br><span class="line">     at java.net.Socket.connect(Socket.java:606)</span><br><span class="line">     at redis.clients.jedis.Connection.connect(Connection.java:184)</span><br><span class="line">     ... 5 more</span><br></pre></td></tr></table></figure>

<p><strong>正常启动后，idea控制台输出0号库的所有key信息。</strong></p>
<p><strong>10.2 操作key相关API</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package com.study.test;</span><br><span class="line"></span><br><span class="line">import org.junit.After;</span><br><span class="line">import org.junit.Before;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"><span class="bullet"> *</span> @ClassName TestKey</span><br><span class="line"><span class="bullet"> *</span> @Description TODO</span><br><span class="line"><span class="bullet"> *</span> @Author chabai</span><br><span class="line"><span class="bullet"> *</span> @Date 2022/9/11 13:52</span><br><span class="line"><span class="bullet"> *</span> @Version 1.0</span><br><span class="line"> <span class="emphasis">*/</span></span><br><span class="line"><span class="emphasis">public class TestKey &#123;</span></span><br><span class="line"><span class="emphasis">    private Jedis jedis;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    @Before</span></span><br><span class="line"><span class="emphasis">    public void before()&#123;</span></span><br><span class="line"><span class="emphasis">        this.jedis = new Jedis(&quot;192.168.1.7&quot;,6379);</span></span><br><span class="line"><span class="emphasis">    &#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    @After</span></span><br><span class="line"><span class="emphasis">    public void after()&#123;</span></span><br><span class="line"><span class="emphasis">        jedis.close();</span></span><br><span class="line"><span class="emphasis">    &#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">    /*</span>*</span><br><span class="line"><span class="bullet">     *</span> 测试key相关</span><br><span class="line"><span class="code">     */</span></span><br><span class="line"><span class="code">    @Test</span></span><br><span class="line"><span class="code">    public void testKeys()&#123;</span></span><br><span class="line"><span class="code">        // 删除一个key</span></span><br><span class="line"><span class="code">        jedis.del(&quot;name&quot;);</span></span><br><span class="line"><span class="code">        // 删除多个key</span></span><br><span class="line"><span class="code">        //jedis.del(&quot;name&quot;,&quot;age&quot;);</span></span><br><span class="line"><span class="code">        </span></span><br><span class="line"><span class="code">        // 判断一个key是否存在</span></span><br><span class="line"><span class="code">        Boolean name = jedis.exists(&quot;name&quot;);</span></span><br><span class="line"><span class="code">        System.out.println(&quot;name = &quot; + name);</span></span><br><span class="line"><span class="code">        </span></span><br><span class="line"><span class="code">        //设置key的超时时间</span></span><br><span class="line"><span class="code">        Long bir = jedis.expire(&quot;bir&quot;, 100);</span></span><br><span class="line"><span class="code">        System.out.println(&quot;bir = &quot; + bir);// 返回1表示未超时</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 查看超时时间</span></span><br><span class="line"><span class="code">        Long bir1 = jedis.ttl(&quot;bir&quot;);</span></span><br><span class="line"><span class="code">        System.out.println(&quot;bir1 = &quot; + bir1);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 获取一个随机key</span></span><br><span class="line"><span class="code">        String s = jedis.randomKey();</span></span><br><span class="line"><span class="code">        System.out.println(&quot;s = &quot; + s);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 修改key名称</span></span><br><span class="line"><span class="code">        String rename = jedis.rename(&quot;age&quot;, &quot;newAge&quot;);</span></span><br><span class="line"><span class="code">        System.out.println(&quot;rename = &quot; + rename);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 查看key对应值的类型</span></span><br><span class="line"><span class="code">        String newAge = jedis.type(&quot;newAge&quot;);</span></span><br><span class="line"><span class="code">        System.out.println(&quot;newAge = &quot; + newAge);</span></span><br><span class="line"><span class="code">        </span></span><br><span class="line"><span class="code">        // ...</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>10.3 操作String相关API</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试String相关</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//set</span></span><br><span class="line">        jedis.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;小陈&quot;</span>);</span><br><span class="line">        <span class="comment">//get</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        <span class="comment">//mset</span></span><br><span class="line">        jedis.mset(<span class="string">&quot;content&quot;</span>,<span class="string">&quot;好人&quot;</span>,<span class="string">&quot;address&quot;</span>,<span class="string">&quot;海淀区&quot;</span>);</span><br><span class="line">        <span class="comment">//mget</span></span><br><span class="line">        List&lt;String&gt; mget = jedis.mget(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;content&quot;</span>, <span class="string">&quot;address&quot;</span>);</span><br><span class="line">        mget.forEach(v-&gt; System.out.println(<span class="string">&quot;v = &quot;</span> + v));</span><br><span class="line">        <span class="comment">//getset</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">set</span> <span class="operator">=</span> jedis.getSet(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小明&quot;</span>);</span><br><span class="line">        System.out.println(set);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//............</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>10.4 操作List相关API</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//lpush</span></span><br><span class="line">    jedis.lpush(<span class="string">&quot;names1&quot;</span>,<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;王五&quot;</span>,<span class="string">&quot;赵柳&quot;</span>,<span class="string">&quot;win7&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//rpush</span></span><br><span class="line">    jedis.rpush(<span class="string">&quot;names1&quot;</span>,<span class="string">&quot;xiaomingming&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//lrange</span></span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; names1 = jedis.lrange(<span class="string">&quot;names1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    names1.forEach(name-&gt; System.out.println(<span class="string">&quot;name = &quot;</span> + name));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//lpop rpop</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">names11</span> <span class="operator">=</span> jedis.lpop(<span class="string">&quot;names1&quot;</span>);</span><br><span class="line">    System.out.println(names11);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//llen</span></span><br><span class="line">    jedis.linsert(<span class="string">&quot;lists&quot;</span>, BinaryClient.LIST_POSITION.BEFORE,<span class="string">&quot;xiaohei&quot;</span>,<span class="string">&quot;xiaobai&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//........</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>10.5 操作Set的相关API</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//sadd</span></span><br><span class="line">   jedis.sadd(<span class="string">&quot;names&quot;</span>,<span class="string">&quot;zhangsan&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//smembers</span></span><br><span class="line">   jedis.smembers(<span class="string">&quot;names&quot;</span>);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//sismember</span></span><br><span class="line">   jedis.sismember(<span class="string">&quot;names&quot;</span>,<span class="string">&quot;xiaochen&quot;</span>);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>10.6 操作ZSet相关API</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZset</span><span class="params">()</span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//zadd</span></span><br><span class="line">   jedis.zadd(<span class="string">&quot;names&quot;</span>,<span class="number">10</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//zrange</span></span><br><span class="line">   jedis.zrange(<span class="string">&quot;names&quot;</span>,<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//zcard</span></span><br><span class="line">   jedis.zcard(<span class="string">&quot;names&quot;</span>);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//zrangeByScore</span></span><br><span class="line">   jedis.zrangeByScore(<span class="string">&quot;names&quot;</span>,<span class="string">&quot;0&quot;</span>,<span class="string">&quot;100&quot;</span>,<span class="number">0</span>,<span class="number">5</span>);</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//..</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>10.7 操作Hash相关API</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="comment">//hset</span></span><br><span class="line">   jedis.hset(<span class="string">&quot;maps&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">   <span class="comment">//hget</span></span><br><span class="line">   jedis.hget(<span class="string">&quot;maps&quot;</span>,<span class="string">&quot;name&quot;</span>);</span><br><span class="line">   <span class="comment">//hgetall</span></span><br><span class="line">   jedis.hgetAll(<span class="string">&quot;mps&quot;</span>);</span><br><span class="line">   <span class="comment">//hkeys</span></span><br><span class="line">   jedis.hkeys(<span class="string">&quot;maps&quot;</span>);</span><br><span class="line">   <span class="comment">//hvals</span></span><br><span class="line">   jedis.hvals(<span class="string">&quot;maps&quot;</span>);</span><br><span class="line">   <span class="comment">//....</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>10.8 项目目录结构</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404150224264.png" alt="image-20240404150224264"></p>
<h3 id="11-springboot整合redis"><a href="#11-springboot整合redis" class="headerlink" title="11.springboot整合redis"></a>11.springboot整合redis</h3><p>​		Spring Boot Data（Spring Data，操作数据框架） Redis中提供了<strong>RedisTemplate和StringRedisTemplate</strong>，其中，StringRedisTemplate是RedisTemplate的子类，两个方法基本一致，不同之处主要体现在操作的数据类型不同，RedisTemplate中的两个泛型都是Object，意味着存储的key和value都可以是一个对象，而StringRedisTemplate的两个泛型都是String，意味着StringRedisTemplate的key和value都只能是字符串。</p>
<p>​	<strong>RedisTemplate （Object，Object)</strong> :  自动序列化  自动反序列化</p>
<p>​	<strong>StringRedisTemplate （String，String）</strong>:  自动序列化  自动反序列化</p>
<p><code>注意: 使用RedisTemplate默认是将对象序列化到Redis中,所以放入的对象必须实现对象序列化接口</code></p>
<h4 id="11-1环境准备"><a href="#11-1环境准备" class="headerlink" title="11.1环境准备"></a><strong>11.1</strong>环境准备</h4><p>​		新建Spring Initializr项目redis-spring-boot，引入spring-boot-devtools、lombok、spring-boot-starter-test、spring-boot-starter-web对应依赖。</p>
<p><strong>11.1.1 pom.xml中引入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入spring-boot-data-redis依赖（内含jedis依赖）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>刷新Maven！</strong></p>
<p><strong>11.1.2application.properties配置redis</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis配置</span></span><br><span class="line"> <span class="attr">spring.redis.host</span>=<span class="string">localhost</span></span><br><span class="line"> <span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"> <span class="attr">spring.redis.database</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure>

<h4 id="11-2使用StringRedisTemplate和RedisTemplate"><a href="#11-2使用StringRedisTemplate和RedisTemplate" class="headerlink" title="11.2使用StringRedisTemplate和RedisTemplate"></a><strong>11.2使用StringRedisTemplate和RedisTemplate</strong></h4><h5 id="11-2-1-测试StringRedisTemplate"><a href="#11-2-1-测试StringRedisTemplate" class="headerlink" title="11.2.1 测试StringRedisTemplate"></a><strong>11.2.1 测试StringRedisTemplate</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.DefaultTypedTuple;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ZSetOperations;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> TestStringRedisTemplate</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/9/12 11:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span><span class="comment">// 此处不需要引入@RunWith注解了</span></span><br><span class="line"><span class="comment">// 针对@RunWith注解找不到的问题：https://blog.csdn.net/u014641168/article/details/125405225</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestStringRedisTemplate</span> &#123;</span><br><span class="line">    <span class="comment">// 注入StringRedisTemplate</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作redis中的字符串：opsForValue()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span>&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line"></span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;1234&quot;</span>,<span class="number">60</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">code</span> <span class="operator">=</span> stringRedisTemplate.getExpire(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;code = &quot;</span> + code);</span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">append</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().append(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;OneTwoThreeFour&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;append = &quot;</span> + append);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作redis中key相关</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testKey</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 删除一个key</span></span><br><span class="line"><span class="comment">//        Boolean name = stringRedisTemplate.delete(&quot;name&quot;);</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;name = &quot; + name);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断key是否存在</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">name1</span> <span class="operator">=</span> stringRedisTemplate.hasKey(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name1 = &quot;</span> + name1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查看所有key</span></span><br><span class="line">        Set&lt;String&gt; keys = stringRedisTemplate.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        keys.forEach(key-&gt; System.out.println(<span class="string">&quot;key = &quot;</span> + key));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获得超时时间</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">name2</span> <span class="operator">=</span> stringRedisTemplate.getExpire(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name2 = &quot;</span> + name2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作redis中list类型：opsForList()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 添加元素</span></span><br><span class="line"><span class="comment">//        stringRedisTemplate.opsForList().leftPush(&quot;names&quot;,&quot;zhangsan&quot;);</span></span><br><span class="line">        <span class="comment">// 添加多个元素</span></span><br><span class="line"><span class="comment">//        stringRedisTemplate.opsForList().leftPushAll(&quot;names&quot;,&quot;lisi&quot;,&quot;wangwu&quot;);</span></span><br><span class="line">        <span class="comment">// 以集合形式进行添加元素</span></span><br><span class="line"><span class="comment">//        List&lt;String&gt; names = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        names.add(&quot;xiaoming&quot;);</span></span><br><span class="line"><span class="comment">//        names.add(&quot;xiaohua&quot;);</span></span><br><span class="line"><span class="comment">//        stringRedisTemplate.opsForList().leftPushAll(&quot;names&quot;,names);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 遍历list</span></span><br><span class="line">        List&lt;String&gt; names1 = stringRedisTemplate.opsForList().range(<span class="string">&quot;names&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : names1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;s = &quot;</span> + s);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 截取指定区间的list，无返回值</span></span><br><span class="line">        stringRedisTemplate.opsForList().trim(<span class="string">&quot;names&quot;</span>,<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">        List&lt;String&gt; names = stringRedisTemplate.opsForList().range(<span class="string">&quot;names&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        names.forEach(name-&gt; System.out.println(<span class="string">&quot;name = &quot;</span> + name));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作redis中set类型：opsForSet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 添加元素</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">add</span> <span class="operator">=</span> stringRedisTemplate.opsForSet().add(<span class="string">&quot;sets&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;wangwu&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;add = &quot;</span> + add);</span><br><span class="line">        <span class="comment">// 遍历元素</span></span><br><span class="line">        <span class="keyword">for</span> (String set : stringRedisTemplate.opsForSet().members(<span class="string">&quot;sets&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;set = &quot;</span> + set);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获得元素个数</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">sets</span> <span class="operator">=</span> stringRedisTemplate.opsForSet().size(<span class="string">&quot;sets&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;sets = &quot;</span> + sets);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作redis中Zset类型: opsForZSet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZset</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 添加单个元素</span></span><br><span class="line">        stringRedisTemplate.opsForZSet().add(<span class="string">&quot;zsets&quot;</span>,<span class="string">&quot;小明&quot;</span>,<span class="number">80</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//以集合形式添加元素</span></span><br><span class="line">        Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; tuples = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            DefaultTypedTuple&lt;String&gt; tuple = <span class="keyword">new</span> <span class="title class_">DefaultTypedTuple</span>&lt;&gt;(<span class="string">&quot;张三&quot;</span> + i, <span class="number">1D</span> + i);</span><br><span class="line">            tuples.add(tuple);</span><br><span class="line">        &#125;</span><br><span class="line">        stringRedisTemplate.opsForZSet().add(<span class="string">&quot;zsets&quot;</span>,tuples);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历value</span></span><br><span class="line">        Set&lt;String&gt; zsets = stringRedisTemplate.opsForZSet().range(<span class="string">&quot;zsets&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        zsets.forEach(value-&gt; System.out.println(<span class="string">&quot;value = &quot;</span> + value));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历value-score</span></span><br><span class="line">        Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; zsets1 = stringRedisTemplate.opsForZSet().rangeByScoreWithScores(<span class="string">&quot;zsets&quot;</span>, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="keyword">for</span> (ZSetOperations.TypedTuple&lt;String&gt; stringTypedTuple : zsets1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;stringTypedTuple = &quot;</span> + stringTypedTuple);</span><br><span class="line">            System.out.println(stringTypedTuple.getValue());</span><br><span class="line">            System.out.println(stringTypedTuple.getScore());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作redis中Hash类型：</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 存入一个元素</span></span><br><span class="line">        stringRedisTemplate.opsForHash().put(<span class="string">&quot;hashs&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 以集合形式存入元素</span></span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>,<span class="string">&quot;20&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;bir&quot;</span>,<span class="string">&quot;2012-12-12&quot;</span>);</span><br><span class="line">        stringRedisTemplate.opsForHash().putAll(<span class="string">&quot;hashs&quot;</span>,map);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取一个值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> (String) stringRedisTemplate.opsForHash().get(<span class="string">&quot;hashs&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;val = &quot;</span> + val);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取多个值</span></span><br><span class="line">        List&lt;Object&gt; objects = stringRedisTemplate.opsForHash().multiGet(<span class="string">&quot;hashs&quot;</span>, Arrays.asList(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>));</span><br><span class="line">        objects.forEach(vals-&gt; System.out.println(<span class="string">&quot;vals = &quot;</span> + vals));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取所有值</span></span><br><span class="line">        List&lt;Object&gt; hashs = stringRedisTemplate.opsForHash().values(<span class="string">&quot;hashs&quot;</span>);</span><br><span class="line">        hashs.forEach(hash-&gt; System.out.println(<span class="string">&quot;hash = &quot;</span> + hash));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取所有key</span></span><br><span class="line">        Set&lt;Object&gt; hashs1 = stringRedisTemplate.opsForHash().keys(<span class="string">&quot;hashs&quot;</span>);</span><br><span class="line">        hashs1.forEach(hash-&gt; System.out.println(<span class="string">&quot;hash = &quot;</span> + hash));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="11-2-2-测试RedisTemplate"><a href="#11-2-2-测试RedisTemplate" class="headerlink" title="11.2.2 测试RedisTemplate"></a><strong>11.2.2 测试RedisTemplate</strong></h5><blockquote>
<p>新建对象User</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Accessors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> User</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/9/12 15:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date bir;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试RedisTemplate：key、value均会被序列化</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> TestRedisTemplate</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/9/12 15:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRedisTemplate</span> &#123;</span><br><span class="line">    <span class="comment">// 注入RedisTemplate&lt;Object,Object&gt;</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试RedisTemplate</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedisTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 获取redis序列化</span></span><br><span class="line">        <span class="type">RedisSerializer</span> <span class="variable">defaultSerializer</span> <span class="operator">=</span> redisTemplate.getDefaultSerializer();</span><br><span class="line">        System.out.println(<span class="string">&quot;defaultSerializer = &quot;</span> + defaultSerializer);</span><br><span class="line">        <span class="comment">//defaultSerializer = org.springframework.data.redis.serializer.JdkSerializationRedisSerializer@4c731956</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * redisTemplate对象中 key 和 value 的序列化都是 JdkSerializationRedisSerializer</span></span><br><span class="line"><span class="comment">         *      key: string</span></span><br><span class="line"><span class="comment">         *      value: object</span></span><br><span class="line"><span class="comment">         *      修改默认key序列化方案 :  key  StringRedisSerializer</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// 修改key采用string序列化方式</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="comment">// 修改hash key采用string序列化方式</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// User必须序列化</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>()</span><br><span class="line">                .setId(UUID.randomUUID().toString())</span><br><span class="line">                    .setName(<span class="string">&quot;小崔&quot;</span>)</span><br><span class="line">                        .setAge(<span class="number">18</span>)</span><br><span class="line">                            .setBir(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">user1</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user1 = &quot;</span> + user1);</span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForList().leftPush(<span class="string">&quot;list&quot;</span>,user);</span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForSet().add(<span class="string">&quot;set&quot;</span>,user);</span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForZSet().add(<span class="string">&quot;zset&quot;</span>,user,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// hash有两个key，默认均为jdk序列化方式</span></span><br><span class="line">        redisTemplate.opsForHash().put(<span class="string">&quot;hash&quot;</span>,<span class="string">&quot;name&quot;</span>,user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>key采用jdk序列化：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404150718697.png" alt="image-20240404150718697"></p>
<p><strong>key采用string序列化：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404150734799.png" alt="image-20240404150734799"></p>
<p><strong>添加后获取key结果：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404150749392.png" alt="image-20240404150749392"></p>
<p><strong>11.2.3 Spring Data提供的Bound API</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.security.auth.callback.NameCallback;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> TestBoundAPI</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/9/12 16:42</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBoundAPI</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Spring Data为了方便我们对redis进行更加友好的操作，提供了Bound API简化操作</span></span><br><span class="line"><span class="comment">     *   1.针对于日后处理key value 都是 String 使用 StringRedisTemplate</span></span><br><span class="line"><span class="comment">     *   2.针对于日后处理的key value 存在对象 使用 RedisTemplate</span></span><br><span class="line"><span class="comment">     *   3.针对于同一个key多次操作可以使用boundXXxOps() Value List Set Zset Hash的api 简化书写</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBound</span><span class="params">()</span>&#123;</span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通常都是将一个key进行多次绑定后操作，操作比较麻烦</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;小崔&quot;</span>);</span><br><span class="line">        stringRedisTemplate.opsForValue().append(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;加油！&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对string类型key进行绑定，后续所有操作都是基于这个key的操作</span></span><br><span class="line">        BoundValueOperations&lt;String, String&gt; nameValueOperation = stringRedisTemplate.boundValueOps(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        nameValueOperation.set(<span class="string">&quot;小猪猪&quot;</span>);</span><br><span class="line">        nameValueOperation.append(<span class="string">&quot;棒棒哒！&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> nameValueOperation.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;s = &quot;</span> + s);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对list类型key进行绑定</span></span><br><span class="line">        BoundListOperations&lt;String, String&gt; boundListOperations = stringRedisTemplate.boundListOps(<span class="string">&quot;list&quot;</span>);</span><br><span class="line">        boundListOperations.leftPushAll(<span class="string">&quot;熊大&quot;</span>,<span class="string">&quot;熊二&quot;</span>,<span class="string">&quot;光头强&quot;</span>);</span><br><span class="line">        List&lt;String&gt; lists = boundListOperations.range(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        lists.forEach(list -&gt; System.out.println(<span class="string">&quot;list = &quot;</span> + list));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对set类型key进行绑定</span></span><br><span class="line">        BoundZSetOperations&lt;String, String&gt; set = stringRedisTemplate.boundZSetOps(<span class="string">&quot;set&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对zset类型进行绑定</span></span><br><span class="line">        BoundZSetOperations&lt;String, String&gt; stringBoundZSetOperations = stringRedisTemplate.boundZSetOps(<span class="string">&quot;zset&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对hash类型key进行绑定</span></span><br><span class="line">        BoundHashOperations&lt;String, Object, Object&gt; boundHashOperations = stringRedisTemplate.boundHashOps(<span class="string">&quot;hash&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>附视频中测试代码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;  <span class="comment">//对字符串支持比较友好,不能存储对象</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;  <span class="comment">//存储对象</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedisTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(redisTemplate);</span><br><span class="line">    <span class="comment">//设置redistemplate值使用对象序列化策略</span></span><br><span class="line">    redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;Object&gt;(Object.class));<span class="comment">//指定值使用对象序列化</span></span><br><span class="line">    <span class="comment">//redisTemplate.opsForValue().set(&quot;user&quot;,new User(&quot;21&quot;,&quot;小黑&quot;,23,new Date()));</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) redisTemplate.opsForValue().get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line"><span class="comment">//      Set keys = redisTemplate.keys(&quot;*&quot;);</span></span><br><span class="line"><span class="comment">//      keys.forEach(key -&gt; System.out.println(key));</span></span><br><span class="line">    <span class="comment">/*Object name = redisTemplate.opsForValue().get(&quot;name&quot;);</span></span><br><span class="line"><span class="comment">    System.out.println(name);*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Object xiaohei = redisTemplate.opsForValue().get(&quot;xiaohei&quot;);</span></span><br><span class="line">    <span class="comment">//System.out.println(xiaohei);</span></span><br><span class="line">    <span class="comment">/*redisTemplate.opsForValue().set(&quot;name&quot;,&quot;xxxx&quot;);</span></span><br><span class="line"><span class="comment">    Object name = redisTemplate.opsForValue().get(&quot;name&quot;);</span></span><br><span class="line"><span class="comment">    System.out.println(name);*/</span></span><br><span class="line">    <span class="comment">/*redisTemplate.opsForList().leftPushAll(&quot;lists&quot;,&quot;xxxx&quot;,&quot;1111&quot;);</span></span><br><span class="line"><span class="comment">    List lists = redisTemplate.opsForList().range(&quot;lists&quot;, 0, -1);</span></span><br><span class="line"><span class="comment">    lists.forEach(list-&gt; System.out.println(list));*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//key的绑定操作 如果日后对某一个key的操作及其频繁,可以将这个key绑定到对应redistemplate中,日后基于绑定操作都是操作这个key</span></span><br><span class="line"><span class="comment">//boundValueOps 用来对String值绑定key</span></span><br><span class="line"><span class="comment">//boundListOps 用来对List值绑定key</span></span><br><span class="line"><span class="comment">//boundSetOps 用来对Set值绑定key</span></span><br><span class="line"><span class="comment">//boundZsetOps 用来对Zset值绑定key</span></span><br><span class="line"><span class="comment">//boundHashOps 用来对Hash值绑定key</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBoundKey</span><span class="params">()</span>&#123;</span><br><span class="line">    BoundValueOperations&lt;String, String&gt; nameValueOperations = stringRedisTemplate.boundValueOps(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    nameValueOperations.set(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="comment">//yuew</span></span><br><span class="line">    nameValueOperations.set(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> nameValueOperations.get();</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//hash相关操作 opsForHash</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span>&#123;</span><br><span class="line">    stringRedisTemplate.opsForHash().put(<span class="string">&quot;maps&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;小黑&quot;</span>);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> stringRedisTemplate.opsForHash().get(<span class="string">&quot;maps&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">    System.out.println(o);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//zset相关操作 opsForZSet</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testZSet</span><span class="params">()</span>&#123;</span><br><span class="line">    stringRedisTemplate.opsForZSet().add(<span class="string">&quot;zsets&quot;</span>,<span class="string">&quot;小黑&quot;</span>,<span class="number">10</span>);</span><br><span class="line">    Set&lt;String&gt; zsets = stringRedisTemplate.opsForZSet().range(<span class="string">&quot;zsets&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    zsets.forEach(value-&gt; System.out.println(value));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//set相关操作 opsForSet</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span>&#123;</span><br><span class="line">    stringRedisTemplate.opsForSet().add(<span class="string">&quot;sets&quot;</span>,<span class="string">&quot;xiaosan&quot;</span>,<span class="string">&quot;xiaosi&quot;</span>,<span class="string">&quot;xiaowu&quot;</span>);</span><br><span class="line">    Set&lt;String&gt; sets = stringRedisTemplate.opsForSet().members(<span class="string">&quot;sets&quot;</span>);</span><br><span class="line">    sets.forEach(value-&gt; System.out.println(value));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//list相关的操作opsForList</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// stringRedisTemplate.opsForList().leftPushAll(&quot;lists&quot;,&quot;张三&quot;,&quot;李四&quot;,&quot;王五&quot;);</span></span><br><span class="line">    List&lt;String&gt; lists = stringRedisTemplate.opsForList().range(<span class="string">&quot;lists&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    lists.forEach(key -&gt; System.out.println(key));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//String相关的操作 opsForValue</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//stringRedisTemplate.opsForValue().set(&quot;166&quot;,&quot;好同学&quot;);</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;166&quot;</span>);</span><br><span class="line">    System.out.println(s);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">size</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().size(<span class="string">&quot;166&quot;</span>);</span><br><span class="line">    System.out.println(size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//key相关的操作</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    Set&lt;String&gt; keys = stringRedisTemplate.keys(<span class="string">&quot;*&quot;</span>);<span class="comment">//查看所有key</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">name</span> <span class="operator">=</span> stringRedisTemplate.hasKey(<span class="string">&quot;name&quot;</span>);<span class="comment">//判断某个key是否存在</span></span><br><span class="line">    stringRedisTemplate.delete(<span class="string">&quot;age&quot;</span>);<span class="comment">//根据指定key删除</span></span><br><span class="line">    stringRedisTemplate.rename(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);<span class="comment">//修改key的名称</span></span><br><span class="line">    stringRedisTemplate.expire(<span class="string">&quot;key&quot;</span>,<span class="number">10</span>, TimeUnit.HOURS);</span><br><span class="line">    <span class="comment">//设置key超时时间 参数1:设置key名 参数2:时间 参数3:时间的单位</span></span><br><span class="line">    stringRedisTemplate.move(<span class="string">&quot;&quot;</span>,<span class="number">1</span>);<span class="comment">//移动key</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="11-3-项目最终目录结构"><a href="#11-3-项目最终目录结构" class="headerlink" title="11.3 项目最终目录结构"></a>11.3 项目最终目录结构</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404150902160.png" alt="image-20240404150902160"></p>
<h3 id="12-redis中应用场景说明"><a href="#12-redis中应用场景说明" class="headerlink" title="12.redis中应用场景说明"></a>12.redis中应用场景说明</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1.利用redis中字符串类型完成：项目中手机验证码存储的实现（有效时间）</span><br><span class="line"></span><br><span class="line">2.利用redis中字符串类型完成：具有失效性业务功能，如：12306、淘宝等，离订单支付关闭还有:40分钟</span><br><span class="line"></span><br><span class="line">3.利用redis实现分布式集群系统中Session共享问题</span><br><span class="line">  memcache：内存、数据存储上限、数据类型比较简单</span><br><span class="line">  redis：内存、解决数据上限、数据类型丰富</span><br><span class="line"></span><br><span class="line">4.利用redis的zset类型（可排序set类型）：元素 分数</span><br><span class="line">  实现如：排行榜之类的功能   </span><br><span class="line"><span class="code">         dangdang 销量排行：sales(zset) [商品id,商品销量] ......</span></span><br><span class="line"><span class="code">                                        唯一标识  分数   可以取前多少区间内的数据，分页显示等</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">5.利用redis实现分布式缓存（提高查询效率）</span><br><span class="line"></span><br><span class="line">6.利用redis存储认证之后token信息（超时特性）</span><br><span class="line">  如：微信小程序、微信公众号 </span><br><span class="line"><span class="code">     用户 openid（用户唯一标识）---&gt; 令牌(token，解决安全问题) redis设置超时时间，时间过后失效</span></span><br><span class="line"><span class="code">  </span></span><br><span class="line"><span class="code">7.利用redis解决分布式集群系统中分布式锁问题   </span></span><br><span class="line"><span class="code">  jvm  1进程开启多个线程 synchronize int n=20</span></span><br><span class="line"><span class="code">  jvm  1进程开启多个线程 synchronize int n=20   集群</span></span><br><span class="line"><span class="code">  .....  LRA脚本</span></span><br><span class="line"><span class="code">  redis 单进程 单线程 n 20 定义</span></span><br><span class="line"><span class="code">                    incr -1</span></span><br><span class="line"><span class="code">                    decr  1</span></span><br></pre></td></tr></table></figure>

<h3 id="13-mybatis自身本地缓存实现"><a href="#13-mybatis自身本地缓存实现" class="headerlink" title="13.mybatis自身本地缓存实现"></a>13.mybatis自身本地缓存实现</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404151107063.png" alt="image-20240404151107063"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404151119450.png" alt="image-20240404151119450"></p>
<p><strong>补充：</strong></p>
<ul>
<li><p>如果数据更新极其频繁，这种情况下不建议使用缓存，因为这种情况下直接从数据库中查询更新后的结果返回即可，一旦将这种数据放入缓存，在更新数据库的同时，还要把缓存中的数据清空或者更新数据，极大地影响了更新业务的属性。一定是将极少发生修改或变动的数据存入缓存。</p>
</li>
<li><p>MySQL集群、Tomcat集群、Memcached集群</p>
</li>
<li><p>分布式建立在集群之上</p>
</li>
</ul>
<p><strong>1.mybatis自身本地缓存实现</strong></p>
<p>mybatis提供了一级、二级缓存，其中：</p>
<p><strong>一级缓存：</strong>线程级别的缓存，也称为本地缓存或sqlSession级别的缓存，一级缓存是默认开启的。当处于同一个会话时，相同两次查询的操作就会从缓存中取。<br><strong>二级缓存：</strong>全局范围的缓存，除了当前sqlSession能用外，其他的也可以使用。二级缓存默认也是开启的，只需要在mapper文件中写一个<cache/>标签即可实现，且在实现时要求pojo必须实现序列化的接口，否则会报错。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404151320419.png" alt="image-20240404151320419"></p>
<blockquote>
<p>创建项目</p>
</blockquote>
<p>新建Spring Initializr项目redis-spring-boot，引入spring-boot-devtools、lombok、spring-boot-starter-test、spring-boot-starter-web对应插件。</p>
<blockquote>
<p>pom.xml中引入依赖</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入spring-boot-data-redis依赖（内含jedis依赖）--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">&lt;!--引入mybatis依赖--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">&lt;!--引入mysql依赖--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.38<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">&lt;!--引入数据源--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>刷新Maven！</strong></p>
<blockquote>
<p>application.properties配置redis、mybatis、日志</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis配置</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="attr">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mybatis配置</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/redis?characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath:com/study/mapper/*.xml</span></span><br><span class="line"><span class="attr">mybatis.type-aliases-package</span>=<span class="string">com.study.entity</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 日志配置</span></span><br><span class="line"><span class="attr">logging.level.com.study.dao</span>=<span class="string">debug</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>启动类添加@MapperScan扫描注解</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.study.dao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisSpringBootApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(RedisSpringBootApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>新建entity实体类—User</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.entity;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"> <span class="keyword">import</span> lombok.Data;</span><br><span class="line"> <span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"> <span class="keyword">import</span> lombok.experimental.Accessors;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"> <span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@ClassName</span> User</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Date</span> 2022/9/12 15:37</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Data</span></span><br><span class="line"> <span class="meta">@NoArgsConstructor</span></span><br><span class="line"> <span class="meta">@AllArgsConstructor</span></span><br><span class="line"> <span class="meta">@Accessors(chain = true)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;<span class="comment">// mybatis要实现缓存，实体类必须序列化</span></span><br><span class="line">     <span class="keyword">private</span> String id;</span><br><span class="line">     <span class="keyword">private</span> String name;</span><br><span class="line">     <span class="keyword">private</span> Integer age;</span><br><span class="line">     <span class="keyword">private</span> Character sex;</span><br><span class="line">     <span class="keyword">private</span> Date bir;</span><br><span class="line">     <span class="keyword">private</span> String address;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>新建dao接口—UserDao</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.dao;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> com.study.entity.User;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@ClassName</span> UserDao</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Date</span> 2022/10/5 18:58</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">     List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>新建mapper文件—UserDaoMapper</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.study.dao.UserDao&quot;&gt;</span><br><span class="line">    &lt;!--使用二级缓存，默认使用的是PerpetualCache这个类，该类实现了Cache接口，此处可以省略对type=&quot;org.apache.ibatis.cache.impl.PerpetualCache&quot;这个属性的指定--&gt;</span><br><span class="line">    &lt;cache/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--findAll--&gt;</span><br><span class="line">    &lt;select id=&quot;findAll&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">        select id,name,age,sex,bir,address from t_user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>新建service接口—IUserService</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> IUserService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/10/5 19:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编写service实现类—UserServiceImpl</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.service;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> com.study.dao.UserDao;</span><br><span class="line"> <span class="keyword">import</span> com.study.entity.User;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@ClassName</span> UserServiceImpl</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Date</span> 2022/10/5 19:04</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Service</span></span><br><span class="line"> <span class="meta">@Transactional</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line">     <span class="meta">@Autowired</span></span><br><span class="line">     <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"> </span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="meta">@Transactional(propagation = Propagation.SUPPORTS)</span></span><br><span class="line">     <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> userDao.findAll();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编写测试类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.test;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> com.study.service.IUserService;</span><br><span class="line"> <span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@ClassName</span> TestUserService</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Date</span> 2022/10/5 19:05</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@SpringBootTest</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestUserService</span> &#123;</span><br><span class="line">     <span class="meta">@Autowired</span></span><br><span class="line">     <span class="keyword">private</span> IUserService userService;</span><br><span class="line">     </span><br><span class="line">     <span class="meta">@Test</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">         userService.findAll().forEach(e-&gt; System.out.println(e));</span><br><span class="line">         System.out.println(<span class="string">&quot;开启缓存后再次查询&quot;</span>);</span><br><span class="line">         userService.findAll().forEach(e-&gt; System.out.println(e));</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>（1）未开启缓存时：</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">2022-10-06 10:56:23.410 DEBUG 31540 --- [           main] com.study.dao.UserDao.findAll            : ==&gt;  Preparing: select id,name,age,sex,bir,address from t<span class="emphasis">_user</span></span><br><span class="line"><span class="emphasis">2022-10-06 10:56:23.421 DEBUG 31540 --- [           main] com.study.dao.UserDao.findAll            : ==&gt; Parameters: </span></span><br><span class="line"><span class="emphasis">2022-10-06 10:56:23.436 DEBUG 31540 --- [           main] com.study.dao.UserDao.findAll            : &lt;==      Total: 6</span></span><br><span class="line"><span class="emphasis">User(id=3, name=喜洋洋, age=30, bir=Sat Aug 13 21:17:25 CST 2022, address=羊村)</span></span><br><span class="line"><span class="emphasis">User(id=4, name=传智播客, age=40, bir=Sun Mar 04 12:04:06 CST 2018, address=北京金燕龙)</span></span><br><span class="line"><span class="emphasis">User(id=5, name=老王, age=50, bir=Wed Mar 07 17:37:26 CST 2018, address=北京)</span></span><br><span class="line"><span class="emphasis">User(id=6, name=小马宝莉, age=60, bir=Thu Mar 08 11:44:00 CST 2018, address=北京修正)</span></span><br><span class="line"><span class="emphasis">User(id=8, name=大猪猪, age=70, bir=Sat Aug 13 20:58:16 CST 2022, address=西虹市)</span></span><br><span class="line"><span class="emphasis">User(id=9, name=皮卡丘, age=80, bir=Sat Aug 13 21:03:49 CST 2022, address=黑龙江)</span></span><br><span class="line"><span class="emphasis">开启缓存后再次查询</span></span><br><span class="line"><span class="emphasis">2022-10-06 10:56:23.440 DEBUG 31540 --- [           main] com.study.dao.UserDao.findAll            : ==&gt;  Preparing: select id,name,age,sex,bir,address from t_</span>user</span><br><span class="line">2022-10-06 10:56:23.440 DEBUG 31540 --- [           main] com.study.dao.UserDao.findAll            : ==&gt; Parameters: </span><br><span class="line">2022-10-06 10:56:23.442 DEBUG 31540 --- [           main] com.study.dao.UserDao.findAll            : &lt;==      Total: 6</span><br><span class="line">User(id=3, name=喜洋洋, age=30, bir=Sat Aug 13 21:17:25 CST 2022, address=羊村)</span><br><span class="line">User(id=4, name=传智播客, age=40, bir=Sun Mar 04 12:04:06 CST 2018, address=北京金燕龙)</span><br><span class="line">User(id=5, name=老王, age=50, bir=Wed Mar 07 17:37:26 CST 2018, address=北京)</span><br><span class="line">User(id=6, name=小马宝莉, age=60, bir=Thu Mar 08 11:44:00 CST 2018, address=北京修正)</span><br><span class="line">User(id=8, name=大猪猪, age=70, bir=Sat Aug 13 20:58:16 CST 2022, address=西虹市)</span><br><span class="line">User(id=9, name=皮卡丘, age=80, bir=Sat Aug 13 21:03:49 CST 2022, address=黑龙江)</span><br></pre></td></tr></table></figure>

<p>结果分析：为什么默认开启了一级缓存，但是还是在两次执行相同查询时均访问了数据库？因为我们这里使用的是service，而每一次service的调用都会重新创建一个新的数据库会话，即不在同一会话中，当service方法调用结束后就会自动的提交事务、关闭会话，所以这种情况一级缓存是不生效的，只能使用二级缓存来减轻数据库访问的压力。<br><strong>（2）开启缓存后测试结果：</strong></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">2022-10-05 19:29:10.186  INFO 7252 --- [           main] com.study.test.TestUserService           : Started TestUserService in 2.038 seconds (JVM running for 2.623)</span><br><span class="line"> 2022-10-05 19:29:10.456  INFO 7252 --- [           main] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-1&#125; inited</span><br><span class="line"> 2022-10-05 19:29:10.624 DEBUG 7252 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 0.0</span><br><span class="line"> 2022-10-05 19:29:10.631 DEBUG 7252 --- [           main] com.study.dao.UserDao.findAll            : ==&gt;  Preparing: select id,name,age,sex,bir,address from t<span class="emphasis">_user</span></span><br><span class="line"><span class="emphasis"> 2022-10-05 19:29:10.646 DEBUG 7252 --- [           main] com.study.dao.UserDao.findAll            : ==&gt; Parameters: </span></span><br><span class="line"><span class="emphasis"> 2022-10-05 19:29:10.657 DEBUG 7252 --- [           main] com.study.dao.UserDao.findAll            : &lt;==      Total: 8</span></span><br><span class="line"><span class="emphasis"> User(id=1, name=老王, age=10, bir=Tue Feb 27 17:47:08 CST 2018, address=北京)</span></span><br><span class="line"><span class="emphasis"> User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span></span><br><span class="line"><span class="emphasis"> User(id=3, name=喜洋洋, age=30, bir=Sat Aug 13 21:17:25 CST 2022, address=羊村)</span></span><br><span class="line"><span class="emphasis"> User(id=4, name=传智播客, age=40, bir=Sun Mar 04 12:04:06 CST 2018, address=北京金燕龙)</span></span><br><span class="line"><span class="emphasis"> User(id=5, name=老王, age=50, bir=Wed Mar 07 17:37:26 CST 2018, address=北京)</span></span><br><span class="line"><span class="emphasis"> User(id=6, name=小马宝莉, age=60, bir=Thu Mar 08 11:44:00 CST 2018, address=北京修正)</span></span><br><span class="line"><span class="emphasis"> User(id=8, name=大猪猪, age=70, bir=Sat Aug 13 20:58:16 CST 2022, address=西虹市)</span></span><br><span class="line"><span class="emphasis"> User(id=9, name=皮卡丘, age=80, bir=Sat Aug 13 21:03:49 CST 2022, address=黑龙江)</span></span><br><span class="line"><span class="emphasis"> 开启缓存后再次查询</span></span><br><span class="line"><span class="emphasis"> 2022-10-05 19:29:10.664  WARN 7252 --- [           main] o.apache.ibatis.io.SerialFilterChecker   : As you are using functionality that deserializes object streams, it is recommended to define the JEP-290 serial filter. Please refer to https://docs.oracle.com/pls/topic/lookup?ctx=javase15&amp;id=GUID-8296D8E8-2B93-4B9A-856E-0A65AF9B8C66</span></span><br><span class="line"><span class="emphasis"> 2022-10-05 19:29:10.667 DEBUG 7252 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 0.5</span></span><br><span class="line"><span class="emphasis"> User(id=1, name=老王, age=10, bir=Tue Feb 27 17:47:08 CST 2018, address=北京)</span></span><br><span class="line"><span class="emphasis"> User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span></span><br><span class="line"><span class="emphasis"> User(id=3, name=喜洋洋, age=30, bir=Sat Aug 13 21:17:25 CST 2022, address=羊村)</span></span><br><span class="line"><span class="emphasis"> User(id=4, name=传智播客, age=40, bir=Sun Mar 04 12:04:06 CST 2018, address=北京金燕龙)</span></span><br><span class="line"><span class="emphasis"> User(id=5, name=老王, age=50, bir=Wed Mar 07 17:37:26 CST 2018, address=北京)</span></span><br><span class="line"><span class="emphasis"> User(id=6, name=小马宝莉, age=60, bir=Thu Mar 08 11:44:00 CST 2018, address=北京修正)</span></span><br><span class="line"><span class="emphasis"> User(id=8, name=大猪猪, age=70, bir=Sat Aug 13 20:58:16 CST 2022, address=西虹市)</span></span><br><span class="line"><span class="emphasis"> User(id=9, name=皮卡丘, age=80, bir=Sat Aug 13 21:03:49 CST 2022, address=黑龙江)</span></span><br></pre></td></tr></table></figure>

<p><strong>结果分析：第一次查询时缓存中并没有数据，需要访问数据库；第二次查询时缓存中已经有数据了，直接从缓存中获取数据，不再通过数据库查询。</strong></p>
<p><strong>其中：Cache Hit Ratio（缓存命中率）&#x3D;从内存中查询的次数 &#x2F; 总查询次数，即：</strong></p>
<ul>
<li>第一次查询时，缓存中不存在数据，需要从数据库查，所以缓存命中率即Cache Hit Ratio：0.0。</li>
<li>第二次查询时，会直接将内存中的数据取出进行返回，所以此时的缓存命中率即Cache Hit Ratio：0.5（1&#x2F;2）。</li>
<li>以此类推，……</li>
</ul>
<blockquote>
<p>最终项目目录结构</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404151823684.png" alt="image-20240404151823684"></p>
<h3 id="14-自定义rediscache实现分布式缓存"><a href="#14-自定义rediscache实现分布式缓存" class="headerlink" title="14.自定义rediscache实现分布式缓存"></a>14.自定义rediscache实现分布式缓存</h3><p>上面提到了实现二级缓存，需要在mapper中写上<cache/>标签，该标签实际对应着mybatis提供的Cache接口，该接口有多个实现类用于提供二级缓存的实现：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404151847903.png" alt="image-20240404151847903"></p>
<p><strong>其中，&lt; cache &#x2F; &gt;指定了mybatis中默认的Cache实现类PerpetualCache，</strong>该语句等价于：</p>
<p><code>&lt;cache type=&quot;org.apache.ibatis.cache.impl.PerpetualCache&quot;/&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404151921424.png" alt="image-20240404151921424"></p>
<blockquote>
<p><strong>Cache源码如下</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.apache.ibatis.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">    String <span class="title function_">getId</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object var1, Object var2)</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getObject</span><span class="params">(Object var1)</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">removeObject</span><span class="params">(Object var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> ReadWriteLock <span class="title function_">getReadWriteLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>PerpetualCache源码如下：</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.apache.ibatis.cache.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.cache.CacheException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerpetualCache</span> <span class="keyword">implements</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Object, Object&gt; cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PerpetualCache</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.cache.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cache.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.cache.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">removeObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.cache.remove(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cache.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.getId() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CacheException</span>(<span class="string">&quot;Cache instances require an ID.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> Cache)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Cache</span> <span class="variable">otherCache</span> <span class="operator">=</span> (Cache)o;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.getId().equals(otherCache.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.getId() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CacheException</span>(<span class="string">&quot;Cache instances require an ID.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.getId().hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>PerpetualCache现原理：</strong>将sql语句作为key，数据作为value存储在一个哈希表中，这是默认的情况，现在我们需要实现redis缓存，且这些缓存数据不再放在服务器应用上，所有我们需要自己写一个实现了Cache接口的缓存类，把该缓存的内容存储到我们的redis服务器，拿缓存也是从redis服务器拿。</p>
<p><strong>14.1自定义RedisCache</strong></p>
<p>注意：该类的对象必须是由mybatis创建的，mybatis会给每个mapper文件创建一个对象，每个对象的id都不一样。在配置完id的相关属性外，我们的RedisCache就能够启动了，但是并不能存取缓存数据，需要实现剩下的方法。</p>
<p>但是有个问题，就是我们装缓存的容器需要使用redis，所以需要操作Redis，我们可以使用上一篇文章讲到的redis整合springboot，但是RedisCache并不是IOC容器中的，是由mybatis进行维护的，不能够直接注入RedisTemplate，我们必须先自定义一个获取IOC容器的工具类，用它来获取IOC容器中的redisTemplate，详见ApplicationContextUtils.</p>
<p> <strong>缓存存取原理：</strong>把mybatis创建时提供的id作为我们redis中的key（外key），创建一个hashmap的数据结构，hashmap的key（内key）就是查询的sql语句，value为对应的数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.util.ApplicationContextUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> RedisCache</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 自定义RedisCache缓存实现，必须要实现Cache接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/10/5 23:14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCache</span> <span class="keyword">implements</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">    <span class="comment">// 必须指定String类型的id，即：当前放入缓存的mapper的namespace</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 必须提供以String类型的id作为入参的构造方法，参见PerpetualCache</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisCache</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;id = &quot;</span> + id);<span class="comment">// id = com.study.dao.UserDao</span></span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回cache的唯一标识id，是通过构造方法传过来的</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@MethodName</span> putObject</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 将数据存入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 23:27 2022/10/5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object key, Object value)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;key = &quot;</span> + key.toString());</span><br><span class="line">        System.out.println(<span class="string">&quot;value = &quot;</span> + value);</span><br><span class="line"><span class="comment">//        // 通过application工具类获取RedisTemplate</span></span><br><span class="line"><span class="comment">//        RedisTemplate redisTemplate = (RedisTemplate) ApplicationContextUtils.getBean(&quot;redisTemplate&quot;);</span></span><br><span class="line"><span class="comment">//        // 设置序列化方式</span></span><br><span class="line"><span class="comment">//        redisTemplate.setKeySerializer(new StringRedisSerializer());</span></span><br><span class="line"><span class="comment">//        redisTemplate.setHashKeySerializer(new StringRedisSerializer());</span></span><br><span class="line"><span class="comment">//        // 使用redisHash类型作为缓存存储模型</span></span><br><span class="line"><span class="comment">//        redisTemplate.opsForHash().put(id.toString(),key.toString(),value);</span></span><br><span class="line">        getRedisTemplate().opsForHash().put(id.toString(),key.toString(),value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@MethodName</span> getObject</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 从缓存中获取数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: java.lang.Object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 23:58 2022/10/5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;key.toString() = &quot;</span> + key.toString());</span><br><span class="line"><span class="comment">//        // 通过application工具类获取RedisTemplate</span></span><br><span class="line"><span class="comment">//        RedisTemplate redisTemplate = (RedisTemplate) ApplicationContextUtils.getBean(&quot;redisTemplate&quot;);</span></span><br><span class="line"><span class="comment">//        // 设置序列化方式</span></span><br><span class="line"><span class="comment">//        redisTemplate.setKeySerializer(new StringRedisSerializer());</span></span><br><span class="line"><span class="comment">//        redisTemplate.setHashKeySerializer(new StringRedisSerializer());</span></span><br><span class="line"><span class="comment">//        // 根据key从redisHash类型中获取数据</span></span><br><span class="line"><span class="comment">//        return redisTemplate.opsForHash().get(id.toString(),key.toString());</span></span><br><span class="line">        <span class="keyword">return</span> getRedisTemplate().opsForHash().get(id.toString(),key.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@MethodName</span> removeObject</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 移除一个缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: java.lang.Object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 0:19 2022/10/6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">removeObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;根据指定key删除缓存&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> getRedisTemplate().opsForHash().delete(id.toString(), key.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;<span class="comment">// 清空所有缓存</span></span><br><span class="line">        System.out.println(<span class="string">&quot;清空缓存&quot;</span>);<span class="comment">// *****增删改时会清空Redis中的缓存*****</span></span><br><span class="line"><span class="comment">//        // 通过application工具类获取RedisTemplate</span></span><br><span class="line"><span class="comment">//        RedisTemplate redisTemplate = (RedisTemplate) ApplicationContextUtils.getBean(&quot;redisTemplate&quot;);</span></span><br><span class="line"><span class="comment">//        // 设置序列化方式</span></span><br><span class="line"><span class="comment">//        redisTemplate.setKeySerializer(new StringRedisSerializer());</span></span><br><span class="line"><span class="comment">//        redisTemplate.setHashKeySerializer(new StringRedisSerializer());</span></span><br><span class="line"><span class="comment">//        // 清空namespace</span></span><br><span class="line"><span class="comment">//        redisTemplate.delete(id.toString());// 清空缓存</span></span><br><span class="line">        getRedisTemplate().delete(id.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@MethodName</span> getSize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span> 用来计算缓存数量/个数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: int</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 0:24 2022/10/6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//        // 通过application工具类获取RedisTemplate</span></span><br><span class="line"><span class="comment">//        RedisTemplate redisTemplate = (RedisTemplate) ApplicationContextUtils.getBean(&quot;redisTemplate&quot;);</span></span><br><span class="line"><span class="comment">//        // 设置序列化方式</span></span><br><span class="line"><span class="comment">//        redisTemplate.setKeySerializer(new StringRedisSerializer());</span></span><br><span class="line"><span class="comment">//        redisTemplate.setHashKeySerializer(new StringRedisSerializer());</span></span><br><span class="line"><span class="comment">//        // 获取hash中key value数量</span></span><br><span class="line"><span class="comment">//        return redisTemplate.opsForHash().size(id.toString()).intValue();// long to int</span></span><br><span class="line">        <span class="keyword">return</span> getRedisTemplate().opsForHash().size(id.toString()).intValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 封装redisTemplate</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate <span class="title function_">getRedisTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">RedisTemplate</span> <span class="variable">redisTemplate</span> <span class="operator">=</span> (RedisTemplate) ApplicationContextUtils.getBean(<span class="string">&quot;redisTemplate&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置序列化方式</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>14.2自定义获取IOC容器的工具类ApplicationContextUtils</strong></p>
<p><strong>注意：</strong>该类需要实现ApplicationContextAware接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> ApplicationContextUtils</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 获取IOC容器工具类：用来获取springboot创建好的工厂</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/10/5 23:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextUtils</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line">    <span class="comment">// 获取到IOC容器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取IOC容器：将创建好的工厂以参数形式传递给这个类</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取ioc容器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title function_">getContext</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 直接获取通过对象名获取bean对象：提供通过对象名在工厂中获取对象的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getBean</span><span class="params">(String beanName)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationContext.getBean(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>至此，就可以在RedisCache中获取到IOC容器里面的对象了。</strong></p>
<p><strong>14.3完善IUserService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> IUserService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/10/5 19:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(String id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>14.4完善UserServiceImpl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.study.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> UserServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/10/5 19:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IUserService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.SUPPORTS)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.SUPPORTS)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        userDao.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>14.5完善UserDao</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> UserDao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/10/5 18:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(String id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>14.6完善UserDaoMapper</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.study.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用二级缓存：使用自定义的RedisCache实现分布式缓存，之后该mapper中的二级缓存都会在redis中存或取--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;com.study.cache.RedisCache&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--findAll--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select id,name,age,sex,bir,address from t_user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--findById--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select id,name,age,sex,bir,address from t_user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--deleteById--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span>&gt;</span></span><br><span class="line">        delete from t_user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>14.7完善测试类完善测试类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.study.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> TestUserService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/10/5 19:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestUserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindAll</span><span class="params">()</span>&#123;</span><br><span class="line">        userService.findAll().forEach(e-&gt; System.out.println(e));</span><br><span class="line">        System.out.println(<span class="string">&quot;开启缓存后再次查询&quot;</span>);</span><br><span class="line">        userService.findAll().forEach(e-&gt; System.out.println(e));</span><br><span class="line">        Cache cache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findById(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">        System.out.println(<span class="string">&quot;开启缓存后再次查询&quot;</span>);</span><br><span class="line">        user = userService.findById(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteById</span><span class="params">()</span>&#123;</span><br><span class="line">        userService.deleteById(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试结果：</strong></p>
<ul>
<li><strong>FindAll第一次查询：</strong></li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">id = com.study.dao.UserDao</span><br><span class="line">key.toString() = 823101175:176818748:com.study.dao.UserDao.findAll:0:2147483647:select id,name,age,sex,bir,address from t_user:SqlSessionFactoryBean</span><br><span class="line">2022-10-06 00:35:42.005 DEBUG 25808 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 0.0</span><br><span class="line">2022-10-06 00:35:42.057  INFO 25808 --- [           main] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-1&#125; inited</span><br><span class="line">2022-10-06 00:35:42.177 DEBUG 25808 --- [           main] com.study.dao.UserDao.findAll            : ==&gt;  Preparing: select id,name,age,sex,bir,address from t_user</span><br><span class="line">2022-10-06 00:35:42.188 DEBUG 25808 --- [           main] com.study.dao.UserDao.findAll            : ==&gt; Parameters: </span><br><span class="line">2022-10-06 00:35:42.197 DEBUG 25808 --- [           main] com.study.dao.UserDao.findAll            : &lt;==      Total: 8</span><br><span class="line">key = 823101175:176818748:com.study.dao.UserDao.findAll:0:2147483647:select id,name,age,sex,bir,address from t_user:SqlSessionFactoryBean</span><br><span class="line">value = [User(id=1, name=老王, age=10, bir=Tue Feb 27 17:47:08 CST 2018, address=北京), User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙), User(id=3, name=喜洋洋, age=30, bir=Sat Aug 13 21:17:25 CST 2022, address=羊村), User(id=4, name=传智播客, age=40, bir=Sun Mar 04 12:04:06 CST 2018, address=北京金燕龙), User(id=5, name=老王, age=50, bir=Wed Mar 07 17:37:26 CST 2018, address=北京), User(id=6, name=小马宝莉, age=60, bir=Thu Mar 08 11:44:00 CST 2018, address=北京修正), User(id=8, name=大猪猪, age=70, bir=Sat Aug 13 20:58:16 CST 2022, address=西虹市), User(id=9, name=皮卡丘, age=80, bir=Sat Aug 13 21:03:49 CST 2022, address=黑龙江)]</span><br><span class="line">User(id=1, name=老王, age=10, bir=Tue Feb 27 17:47:08 CST 2018, address=北京)</span><br><span class="line">User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span><br><span class="line">User(id=3, name=喜洋洋, age=30, bir=Sat Aug 13 21:17:25 CST 2022, address=羊村)</span><br><span class="line">User(id=4, name=传智播客, age=40, bir=Sun Mar 04 12:04:06 CST 2018, address=北京金燕龙)</span><br><span class="line">User(id=5, name=老王, age=50, bir=Wed Mar 07 17:37:26 CST 2018, address=北京)</span><br><span class="line">User(id=6, name=小马宝莉, age=60, bir=Thu Mar 08 11:44:00 CST 2018, address=北京修正)</span><br><span class="line">User(id=8, name=大猪猪, age=70, bir=Sat Aug 13 20:58:16 CST 2022, address=西虹市)</span><br><span class="line">User(id=9, name=皮卡丘, age=80, bir=Sat Aug 13 21:03:49 CST 2022, address=黑龙江)</span><br><span class="line">开启缓存后再次查询</span><br><span class="line">key.toString() = 823101175:176818748:com.study.dao.UserDao.findAll:0:2147483647:select id,name,age,sex,bir,address from t_user:SqlSessionFactoryBean</span><br><span class="line">2022-10-06 00:35:42.209 DEBUG 25808 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 0.5</span><br><span class="line">User(id=1, name=老王, age=10, bir=Tue Feb 27 17:47:08 CST 2018, address=北京)</span><br><span class="line">User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span><br><span class="line">User(id=3, name=喜洋洋, age=30, bir=Sat Aug 13 21:17:25 CST 2022, address=羊村)</span><br><span class="line">User(id=4, name=传智播客, age=40, bir=Sun Mar 04 12:04:06 CST 2018, address=北京金燕龙)</span><br><span class="line">User(id=5, name=老王, age=50, bir=Wed Mar 07 17:37:26 CST 2018, address=北京)</span><br><span class="line">User(id=6, name=小马宝莉, age=60, bir=Thu Mar 08 11:44:00 CST 2018, address=北京修正)</span><br><span class="line">User(id=8, name=大猪猪, age=70, bir=Sat Aug 13 20:58:16 CST 2022, address=西虹市)</span><br><span class="line">User(id=9, name=皮卡丘, age=80, bir=Sat Aug 13 21:03:49 CST 2022, address=黑龙江)</span><br></pre></td></tr></table></figure>

<p><strong>之后查询：</strong></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">id = com.study.dao.UserDao</span><br><span class="line"> key.toString() = 823101175:176818748:com.study.dao.UserDao.findAll:0:2147483647:select id,name,age,sex,bir,address from t_user:SqlSessionFactoryBean</span><br><span class="line"> 2022-10-06 00:36:58.125 DEBUG 27764 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 1.0</span><br><span class="line"> User(id=1, name=老王, age=10, bir=Tue Feb 27 17:47:08 CST 2018, address=北京)</span><br><span class="line"> User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span><br><span class="line"> User(id=3, name=喜洋洋, age=30, bir=Sat Aug 13 21:17:25 CST 2022, address=羊村)</span><br><span class="line"> User(id=4, name=传智播客, age=40, bir=Sun Mar 04 12:04:06 CST 2018, address=北京金燕龙)</span><br><span class="line"> User(id=5, name=老王, age=50, bir=Wed Mar 07 17:37:26 CST 2018, address=北京)</span><br><span class="line"> User(id=6, name=小马宝莉, age=60, bir=Thu Mar 08 11:44:00 CST 2018, address=北京修正)</span><br><span class="line"> User(id=8, name=大猪猪, age=70, bir=Sat Aug 13 20:58:16 CST 2022, address=西虹市)</span><br><span class="line"> User(id=9, name=皮卡丘, age=80, bir=Sat Aug 13 21:03:49 CST 2022, address=黑龙江)</span><br><span class="line"> 开启缓存后再次查询</span><br><span class="line"> key.toString() = 823101175:176818748:com.study.dao.UserDao.findAll:0:2147483647:select id,name,age,sex,bir,address from t_user:SqlSessionFactoryBean</span><br><span class="line"> 2022-10-06 00:36:58.130 DEBUG 27764 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 1.0</span><br><span class="line"> User(id=1, name=老王, age=10, bir=Tue Feb 27 17:47:08 CST 2018, address=北京)</span><br><span class="line"> User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span><br><span class="line"> User(id=3, name=喜洋洋, age=30, bir=Sat Aug 13 21:17:25 CST 2022, address=羊村)</span><br><span class="line"> User(id=4, name=传智播客, age=40, bir=Sun Mar 04 12:04:06 CST 2018, address=北京金燕龙)</span><br><span class="line"> User(id=5, name=老王, age=50, bir=Wed Mar 07 17:37:26 CST 2018, address=北京)</span><br><span class="line"> User(id=6, name=小马宝莉, age=60, bir=Thu Mar 08 11:44:00 CST 2018, address=北京修正)</span><br><span class="line"> User(id=8, name=大猪猪, age=70, bir=Sat Aug 13 20:58:16 CST 2022, address=西虹市)</span><br><span class="line"> User(id=9, name=皮卡丘, age=80, bir=Sat Aug 13 21:03:49 CST 2022, address=黑龙江)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>FindById第一次查询：</strong></li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">id = com.study.dao.UserDao</span><br><span class="line"> 2022-10-06 00:40:56.075  INFO 1896 --- [           main] com.study.test.TestUserService           : Started TestUserService in 1.981 seconds (JVM running for 2.58)</span><br><span class="line"> key.toString() = 2088317128:4853372865:com.study.dao.UserDao.findById:0:2147483647:select id,name,age,sex,bir,address from t_user where id=?:2:SqlSessionFactoryBean</span><br><span class="line"> 2022-10-06 00:40:56.927 DEBUG 1896 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 0.0</span><br><span class="line"> 2022-10-06 00:40:56.974  INFO 1896 --- [           main] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-1&#125; inited</span><br><span class="line"> 2022-10-06 00:40:57.083 DEBUG 1896 --- [           main] com.study.dao.UserDao.findById           : ==&gt;  Preparing: select id,name,age,sex,bir,address from t_user where id=?</span><br><span class="line"> 2022-10-06 00:40:57.093 DEBUG 1896 --- [           main] com.study.dao.UserDao.findById           : ==&gt; Parameters: 2(String)</span><br><span class="line"> 2022-10-06 00:40:57.100 DEBUG 1896 --- [           main] com.study.dao.UserDao.findById           : &lt;==      Total: 1</span><br><span class="line"> key = 2088317128:4853372865:com.study.dao.UserDao.findById:0:2147483647:select id,name,age,sex,bir,address from t_user where id=?:2:SqlSessionFactoryBean</span><br><span class="line"> value = [User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)]</span><br><span class="line"> user = User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span><br><span class="line"> 开启缓存后再次查询</span><br><span class="line"> key.toString() = 2088317128:4853372865:com.study.dao.UserDao.findById:0:2147483647:select id,name,age,sex,bir,address from t_user where id=?:2:SqlSessionFactoryBean</span><br><span class="line"> 2022-10-06 00:40:57.111 DEBUG 1896 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 0.5</span><br><span class="line"> user = User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span><br></pre></td></tr></table></figure>

<p><strong>之后再查询：</strong></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">id = com.study.dao.UserDao</span><br><span class="line"> 2022-10-06 00:41:35.210  INFO 14564 --- [           main] com.study.test.TestUserService           : Started TestUserService in 2.012 seconds (JVM running for 2.61)</span><br><span class="line"> key.toString() = 2088317128:4853372865:com.study.dao.UserDao.findById:0:2147483647:select id,name,age,sex,bir,address from t_user where id=?:2:SqlSessionFactoryBean</span><br><span class="line"> 2022-10-06 00:41:36.200 DEBUG 14564 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 1.0</span><br><span class="line"> user = User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span><br><span class="line"> 开启缓存后再次查询</span><br><span class="line"> key.toString() = 2088317128:4853372865:com.study.dao.UserDao.findById:0:2147483647:select id,name,age,sex,bir,address from t_user where id=?:2:SqlSessionFactoryBean</span><br><span class="line"> 2022-10-06 00:41:36.205 DEBUG 14564 --- [           main] com.study.dao.UserDao                    : Cache Hit Ratio [com.study.dao.UserDao]: 1.0</span><br><span class="line"> user = User(id=2, name=小二王, age=20, bir=Fri Mar 02 15:09:37 CST 2018, address=北京金燕龙)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>删除测试：</strong></li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id = com.study.dao.UserDao</span><br><span class="line"> 2022-10-06 00:45:07.281  INFO 22772 --- [           main] com.study.test.TestUserService           : Started TestUserService in 1.997 seconds (JVM running for 2.638)</span><br><span class="line"> 2022-10-06 00:45:07.532  INFO 22772 --- [           main] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-1&#125; inited</span><br><span class="line"> 2022-10-06 00:45:07.692 DEBUG 22772 --- [           main] com.study.dao.UserDao.deleteById         : ==&gt;  Preparing: delete from t_user where id=?</span><br><span class="line"> 2022-10-06 00:45:07.703 DEBUG 22772 --- [           main] com.study.dao.UserDao.deleteById         : ==&gt; Parameters: 2(String)</span><br><span class="line"> 2022-10-06 00:45:07.704 DEBUG 22772 --- [           main] com.study.dao.UserDao.deleteById         : &lt;==    Updates: 0</span><br><span class="line"> 清空缓存</span><br></pre></td></tr></table></figure>

<p>可以看到，使用到了二级缓存，重复的查找只查找了一次，第二次是在缓存中获取到的，redis中的数据如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404152741590.png" alt="image-20240404152741590"></p>
<p>从redis中可以看出，正好两个查询对应有两个键值对，没有任何问题。这两个查询的值已经到我们的redis服务器中了，如果再启动一次测试代码，那么更简单，直接全部在redis服务器中取，一次数据库的查询都不需要。</p>
<p><strong>14.8完善增、改相关操作</strong></p>
<blockquote>
<p>IUserService</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>UserServiceImpl</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    userDao.save(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    userDao.update(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>UserDao</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>UserDaoMapper</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--save--&gt;</span><br><span class="line">&lt;insert id=<span class="string">&quot;save&quot;</span> parameterType=<span class="string">&quot;User&quot;</span>&gt;</span><br><span class="line">    insert into t_user <span class="title function_">values</span> <span class="params">(#&#123;id&#125;,#&#123;name&#125;,#&#123;age&#125;,#&#123;sex&#125;,#&#123;bir&#125;,#&#123;address&#125;)</span></span><br><span class="line">&lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--update--&gt;</span><br><span class="line">&lt;update id=<span class="string">&quot;update&quot;</span> parameterType=<span class="string">&quot;User&quot;</span>&gt;</span><br><span class="line">    update t_user set name=#&#123;name&#125;,age=#&#123;age&#125;,sex=#&#123;sex&#125;,bir=#&#123;bir&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span>&#123;</span><br><span class="line">    userService.save(<span class="keyword">new</span> <span class="title class_">User</span>()</span><br><span class="line">            .setName(<span class="string">&quot;小崔&quot;</span>)</span><br><span class="line">            .setAge(<span class="number">18</span>)</span><br><span class="line">             .setSex(<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line">            .setBir(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">            .setAddress(<span class="string">&quot;天山人间&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">    userService.update(<span class="keyword">new</span> <span class="title class_">User</span>()</span><br><span class="line">            .setId(<span class="string">&quot;10&quot;</span>)</span><br><span class="line">            .setName(<span class="string">&quot;猪猪侠&quot;</span>)</span><br><span class="line">            .setAge(<span class="number">8</span>)</span><br><span class="line">            .setSex(<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line">            .setBir(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">            .setAddress(<span class="string">&quot;棒棒糖村&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行后发现执行增删改操作后，均会清空redis的缓存。</strong></p>
<p><strong>14.9缓存在项目中的应用</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404152946970.png" alt="image-20240404152946970"></p>
<p>当执行增删改操作时，就回调用RedisCache中的clear方法，清空redis中该key对应的所有数据，也就是以mapper文件为单位进行情况，根据id为标志，并不能影响到其他的表。</p>
<p>如果多张表不存在任何的关联查询，就不会出现问题；但如果其中有关联查询，如果修改了其中一个表，紧接着删除了该表的所有缓存，但另一张关联的表是不会清除缓存的，这时就会出现查询到的数据与数据库不统一的情况。</p>
<p>这时候就需要修改一些，使得我们有关联关系的两张表增删改其中的一张表时，就清空所有的关联表的缓存，不仅仅删除自身的缓存。所有我们就不能在每张表都设置一个cache标签了，让两个有关联关系的表共用一个RedisCache对象，如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404153026469.png" alt="image-20240404153026469"></p>
<p>只需要一个cache-ref标签即可，这样的话这两个mapper的缓存就在一起了，清空也是全清空。</p>
<p><strong>14.10缓存优化策略</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404153053927.png" alt="image-20240404153053927"></p>
<p>一般Redis中单个key、value长度大小原则上不超过1GB。这一步主要是对缓存的键值对的一个优化措施，从上面的图片可以看到，key对应于一条sql语句加上其他的一些信息，看起来很冗长，这样会影响redis的性能，我们要尽可能设计的简洁一下。</p>
<p> 我们的目的是让key变短，且必须是唯一的，不能够冲突，这一特点可以使用加密算法那一模板的报文摘要技术，把一个长的数据变为一个固定长度的数据，且能够唯一的区分。最常用的报文摘要就是即MD5，我们就将key进行MD5加密，再存放到redis服务器中。写为这种形式：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404153129328.png" alt="image-20240404153129328"></p>
<p><strong>优化RedisCache：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.cache;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> com.study.util.ApplicationContextUtils;</span><br><span class="line"> <span class="keyword">import</span> org.apache.ibatis.cache.Cache;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@ClassName</span> RedisCache</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Description</span> 自定义RedisCache缓存实现</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Date</span> 2022/10/5 23:14</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCache</span> <span class="keyword">implements</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">     <span class="comment">// 必须指定String类型的id，即：当前放入缓存的mapper的namespace</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// 必须提供以String类型的id作为入参的构造方法</span></span><br><span class="line">     <span class="keyword">public</span> <span class="title function_">RedisCache</span><span class="params">(String id)</span>&#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;id = &quot;</span> + id);<span class="comment">// id = com.study.dao.UserDao</span></span><br><span class="line">         <span class="built_in">this</span>.id = id;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// 返回cache的唯一标识</span></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@MethodName</span> putObject</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Description</span> 缓存中放入数据</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span>: key</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span>: value</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Date</span> 23:27 2022/10/5</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object key, Object value)</span> &#123;</span><br><span class="line">         <span class="comment">// 使用redisHash类型作为缓存存储模型</span></span><br><span class="line">         getRedisTemplate().opsForHash().put(id.toString(),getKeyToMD5(key.toString()),value);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@MethodName</span> getObject</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Description</span> 缓存中获取数据</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span>: key</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@return</span>: java.lang.Object</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Date</span> 23:58 2022/10/5</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> getRedisTemplate().opsForHash().get(id.toString(),getKeyToMD5(key.toString()));</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@MethodName</span> removeObject</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Description</span> 根据指定key删除缓存</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span>: key</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@return</span>: java.lang.Object</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Date</span> 0:19 2022/10/6</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> Object <span class="title function_">removeObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> getRedisTemplate().opsForHash().delete(id.toString(),getKeyToMD5(key.toString()));</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@MethodName</span> clear</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Description</span> 清空所有缓存：增删改时执行</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Date</span> 13:15 2022/10/6</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">         getRedisTemplate().delete(id.toString());</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@MethodName</span> getSize</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Description</span> 用来计算缓存数量</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@return</span>: int</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Date</span> 0:24 2022/10/6</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> getRedisTemplate().opsForHash().size(id.toString()).intValue();<span class="comment">// long to int</span></span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@MethodName</span> 封装redisTemplate</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Date</span> 13:16 2022/10/6</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="keyword">private</span> RedisTemplate <span class="title function_">getRedisTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">         <span class="comment">// 通过application工具类获取RedisTemplate</span></span><br><span class="line">         <span class="type">RedisTemplate</span> <span class="variable">redisTemplate</span> <span class="operator">=</span> (RedisTemplate) ApplicationContextUtils.getBean(<span class="string">&quot;redisTemplate&quot;</span>);</span><br><span class="line">         <span class="comment">// 设置序列化方式</span></span><br><span class="line">         redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">         redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">         <span class="keyword">return</span> redisTemplate;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@MethodName</span> getKeyToMD5</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Description</span> 封装一个对key进行md5加密处理的方法，用于简化缓存数据存储时key的长度</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span>: key</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@return</span>: java.lang.String</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Author</span> chabai</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@Date</span> 16:35 2022/10/6</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="keyword">private</span> String <span class="title function_">getKeyToMD5</span><span class="params">(String key)</span>&#123;</span><br><span class="line">         <span class="keyword">return</span> DigestUtils.md5DigestAsHex(key.getBytes());</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>重新清空redis，并运行查询后结果如下：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404153217220.png" alt="image-20240404153217220"></p>
<p><strong>实测结果：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404153236655.png" alt="image-20240404153236655"></p>
<p>键名的长度得到了明显的缩减，查找速度也会变快一点，相应的也能给缓存设置一个超时时间。</p>
<p><strong>14.11最终项目目录结构</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404153303196.png" alt="image-20240404153303196"></p>
<p><strong>14.12缓存相关面试题</strong></p>
<p><strong>14.12.1缓存穿透</strong></p>
<p><strong>缓存穿透：</strong>是指客户端请求的数据在缓存中和数据库中都不存在(如查找id为-1的数据)，这样缓存永远不会生效，这些恶意请求都会到达数据库，让数据库承受巨大的压力，严重情况下会使服务器宕机。</p>
<p>注意：mybatis中cache解决了缓存穿透，将数据库中没有查询到的j结果也进行缓存，下次再有相同查找时直接从缓冲中返回空数据。<br><strong>有常用的两种解决方法：</strong></p>
<ul>
<li><p>缓存空对象：把查到为空的数据也缓存在缓存中，下次再有相同的形式查找就会从缓存中拿到空数据。</p>
<ul>
<li><p>优点：实现简单，维护方便</p>
</li>
<li><p>缺点：</p>
<p>1.额外的内存消耗(可能会恶意使用随机值查找)，解决方法为设置超时时间；</p>
<p>2.可能造成短期的不一致</p>
</li>
</ul>
</li>
<li><p>布隆过滤：请求时先访问布隆过滤器，如果存在，要查的数据就放行；如果不存在，就拒绝。优点：内存占用小，没有多余key</p>
<p>缺点：可能误判，实现复杂</p>
</li>
<li><p>实时监控：发现Redis的命中率变低了，就进行排查。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404153516607.png" alt="image-20240404153516607"></p>
</li>
</ul>
<p>另外，还可以通过增强id的复杂度，避免被操作id的规律、做好基础校验等主动的解决方案。</p>
<p><strong>14.12.2缓存雪崩</strong></p>
<p><strong>缓存雪崩：</strong>是指在某一时期，大量的缓存同时失效或者redis服务器宕机，导致大量的请求到达数据库，带来巨大的压力，使数据库阻塞或挂起。</p>
<p><strong>举例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 缓存超时 所有业务同一时刻缓存全部失效，极有可能出现缓存雪崩情况</span><br><span class="line"> getRedisTemplate().expire(id.toString(),1, TimeUnit.HOURS);</span><br></pre></td></tr></table></figure>

<p><strong>解决方案：</strong></p>
<ul>
<li><p>缓存永久存储，不推荐</p>
</li>
<li><p>给不同的缓存添加不同的过期时间(常用的数据ttl更长，冷门的ttl更短)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(id.equals(<span class="string">&quot;com.baizhi.dao.UserDAO&quot;</span>))&#123;</span><br><span class="line">    <span class="comment">//缓存超时  client  用户   client  员工</span></span><br><span class="line">    getRedisTemplate().expire(id.toString(),<span class="number">1</span>, TimeUnit.HOURS);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(id.equals(<span class="string">&quot;com.baizhi.dao.CityDAO&quot;</span>))&#123;</span><br><span class="line">    <span class="comment">//缓存超时  client  用户   client  员工</span></span><br><span class="line">    getRedisTemplate().expire(id.toString(),<span class="number">30</span>, TimeUnit.MINUTES);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//.....指定不同业务模块设置不同缓存超时时间</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>利用rediis集群提高服务的可用性，防止宕机</p>
</li>
<li><p>给缓存业务添加降级限流策略</p>
</li>
<li><p>给业务添加多级缓存，nginx缓存+redis缓存+其他缓存</p>
</li>
</ul>
<p><strong>14.12.3 缓存击穿</strong></p>
<p><strong>缓存击穿：</strong>也叫热点Key问题，就是一个被高并发访问并且缓存重建业务较复杂的key突然失效了，无数的请求访问会在瞬间给数据库带来巨大的冲击。<strong>和雪崩的区别就是不是大量的key过期，redis还是正常状态，但数据库却崩了。</strong></p>
<p><strong>常用解决方案：</strong></p>
<ul>
<li><p>互斥锁：同时只让一个线程查询数据库，其他的都等待从缓存中取，实现简单，强一致性，但性能差，可用性变低了。</p>
</li>
<li><p>逻辑过期：永久存储该数据，但在数据中额外存储一个逻辑的过期时间。取到该数据时检测到过期了，那还是返回该数据，只不过会再新开一个线程去同步数据库的新数据到缓存。最终一致性，实现复杂。</p>
</li>
<li><p>预先设置热门数据：在redis高峰访问之前，把热门的数据提前存到redis里，并加大热门数据的ttl。</p>
</li>
<li><p>实时调整：监控热门数据，调整key的ttl</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404153808432.png" alt="image-20240404153808432"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../UpPictures/redisPictures/image-20240404153817022.png" alt="image-20240404153817022"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://chabai000.github.io">茶白</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://chabai000.github.io/posts/44296/">https://chabai000.github.io/posts/44296/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chabai000.github.io" target="_blank">茶白的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/redis/">redis</a></div><div class="post_share"><div class="social-share" data-image="/UpPictures/UpCover/redis.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/%E8%B5%9E%E8%B5%8F%E7%A0%81.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E8%B5%9E%E8%B5%8F%E7%A0%81.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/24839/" title="vue"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/UpPictures/UpCover/vue.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">vue</div></div></a></div><div class="next-post pull-right"><a href="/posts/39847/" title="spring6"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/UpPictures/UpCover/SpringCover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">spring6</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">茶白</div><div class="author-info__description">不论你在什么时候开始，重要的是开始之后就不要停止；不论你在什么时候结束，重要的是结束之后就不要悔恨</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/chabai000"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/chabai000" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1693522579@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-NoSQL%E7%9A%84%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">1. NoSQL的引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AFNoSQL"><span class="toc-number">2.</span> <span class="toc-text">2. 为什么是NoSQL?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-NoSQL%E7%9A%84%E5%9B%9B%E5%A4%A7%E5%88%86%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">3. NoSQL的四大分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E9%94%AE%E5%80%BC%E5%AF%B9-Key-Value-%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 键值对(Key-Value)存储数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%97%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 列存储数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E6%96%87%E6%A1%A3%E5%9E%8B-Document-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 文档型(Document)数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%9B%BE%E5%BD%A2-Graph-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 图形(Graph)数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-NoSQL%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.</span> <span class="toc-text">4. NoSQL应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E4%BB%80%E4%B9%88%E6%98%AFRedis"><span class="toc-number">5.</span> <span class="toc-text">5. 什么是Redis?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Redis%E7%89%B9%E7%82%B9"><span class="toc-number">6.</span> <span class="toc-text">6. Redis特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Redis%E5%AE%89%E8%A3%85"><span class="toc-number">7.</span> <span class="toc-text">7. Redis安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-Redis%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="toc-number">8.</span> <span class="toc-text">8. Redis数据库相关指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-0redis%E7%BB%86%E8%8A%82"><span class="toc-number">8.1.</span> <span class="toc-text">8.0redis细节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4"><span class="toc-number">8.2.</span> <span class="toc-text">8.1 数据库操作指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E6%93%8D%E4%BD%9Ckey%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="toc-number">8.3.</span> <span class="toc-text">8.2 操作key相关指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-String%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.4.</span> <span class="toc-text">8.3 String类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-3-1-%E5%86%85%E5%AD%98%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.4.1.</span> <span class="toc-text">8.3.1 内存存储模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-3-2-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">8.4.2.</span> <span class="toc-text">8.3.2 常用操作命令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-List%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.5.</span> <span class="toc-text">8.4 List类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-4-1-%E5%86%85%E5%AD%98%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.5.1.</span> <span class="toc-text">8.4.1 内存存储模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-4-2-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E6%8C%87%E4%BB%A4"><span class="toc-number">8.5.2.</span> <span class="toc-text">8.4.2 常用操作指令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-Set%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.6.</span> <span class="toc-text">8.5 Set类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-5-1-%E5%86%85%E5%AD%98%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.6.1.</span> <span class="toc-text">8.5.1 内存存储模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-5-2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">8.6.2.</span> <span class="toc-text">8.5.2 常用命令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-6-ZSet%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.7.</span> <span class="toc-text">8.6 ZSet类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-6-1-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.7.1.</span> <span class="toc-text">8.6.1 内存模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-6-2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">8.7.2.</span> <span class="toc-text">8.6.2 常用命令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7-hash%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.8.</span> <span class="toc-text">8.7 hash类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-7-1-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B"><span class="toc-number">8.8.1.</span> <span class="toc-text">8.7.1 内存模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-7-2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">8.8.2.</span> <span class="toc-text">8.7.2 常用命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-redis%E6%A1%8C%E9%9D%A2%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7"><span class="toc-number">9.</span> <span class="toc-text">9. redis桌面可视化工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6"><span class="toc-number">10.</span> <span class="toc-text">9.持久化机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1%E5%BF%AB%E7%85%A7-Snapshot-RDB"><span class="toc-number">10.1.</span> <span class="toc-text">9.1快照(Snapshot)&#x2F;RDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-%E5%8F%AA%E8%BF%BD%E5%8A%A0%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6-AOF"><span class="toc-number">10.2.</span> <span class="toc-text">9.2 只追加日志文件(AOF)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-%E6%8C%81%E4%B9%85%E5%8C%96%E6%80%BB%E7%BB%93"><span class="toc-number">10.3.</span> <span class="toc-text">9.3 持久化总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-java%E6%93%8D%E4%BD%9Credis"><span class="toc-number">11.</span> <span class="toc-text">10.java操作redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-springboot%E6%95%B4%E5%90%88redis"><span class="toc-number">12.</span> <span class="toc-text">11.springboot整合redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">12.1.</span> <span class="toc-text">11.1环境准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2%E4%BD%BF%E7%94%A8StringRedisTemplate%E5%92%8CRedisTemplate"><span class="toc-number">12.2.</span> <span class="toc-text">11.2使用StringRedisTemplate和RedisTemplate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#11-2-1-%E6%B5%8B%E8%AF%95StringRedisTemplate"><span class="toc-number">12.2.1.</span> <span class="toc-text">11.2.1 测试StringRedisTemplate</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#11-2-2-%E6%B5%8B%E8%AF%95RedisTemplate"><span class="toc-number">12.2.2.</span> <span class="toc-text">11.2.2 测试RedisTemplate</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-%E9%A1%B9%E7%9B%AE%E6%9C%80%E7%BB%88%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">12.3.</span> <span class="toc-text">11.3 项目最终目录结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-redis%E4%B8%AD%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">13.</span> <span class="toc-text">12.redis中应用场景说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-mybatis%E8%87%AA%E8%BA%AB%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0"><span class="toc-number">14.</span> <span class="toc-text">13.mybatis自身本地缓存实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E8%87%AA%E5%AE%9A%E4%B9%89rediscache%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98"><span class="toc-number">15.</span> <span class="toc-text">14.自定义rediscache实现分布式缓存</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/7648/" title="java八股文-高级篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.dujin.org/bing/1366.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java八股文-高级篇"/></a><div class="content"><a class="title" href="/posts/7648/" title="java八股文-高级篇">java八股文-高级篇</a><time datetime="2023-06-11T14:12:54.000Z" title="发表于 2023-06-11 22:12:54">2023-06-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/43771/" title="shell脚本快速入门"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.dujin.org/bing/1366.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="shell脚本快速入门"/></a><div class="content"><a class="title" href="/posts/43771/" title="shell脚本快速入门">shell脚本快速入门</a><time datetime="2022-06-24T12:55:57.000Z" title="发表于 2022-06-24 20:55:57">2022-06-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/55491/" title="java常用知识集"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/UpPictures/UpCover/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java常用知识集"/></a><div class="content"><a class="title" href="/posts/55491/" title="java常用知识集">java常用知识集</a><time datetime="2022-05-19T12:32:28.000Z" title="发表于 2022-05-19 20:32:28">2022-05-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/37319/" title="jvm"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/UpPictures/UpCover/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="jvm"/></a><div class="content"><a class="title" href="/posts/37319/" title="jvm">jvm</a><time datetime="2022-05-19T04:13:32.000Z" title="发表于 2022-05-19 12:13:32">2022-05-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/12796/" title="centos7"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/UpPictures/UpCover/centos.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="centos7"/></a><div class="content"><a class="title" href="/posts/12796/" title="centos7">centos7</a><time datetime="2022-05-18T07:14:53.000Z" title="发表于 2022-05-18 15:14:53">2022-05-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 茶白</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const disqus_config = function () {
    this.page.url = 'https://chabai000.github.io/posts/44296/'
    this.page.identifier = '/posts/44296/'
    this.page.title = 'redis'
  }

  const disqusReset = () => {
    window.DISQUS && window.DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addGlobalFn('themeChange', disqusReset, 'disqus')

  const loadDisqus = () =>{
    if (window.DISQUS) disqusReset()
    else {
      const script = document.createElement('script')
      script.src = 'https://lchabai.disqus.com/embed.js'
      script.setAttribute('data-timestamp', +new Date())
      document.head.appendChild(script)
    }
  }

  const getCount = async() => {
    try {
      const eleGroup = document.querySelector('#post-meta .disqus-comment-count')
      if (!eleGroup) return
      const cleanedLinks = eleGroup.href.replace(/#post-comment$/, '')

      const res = await fetch(`https://disqus.com/api/3.0/threads/set.json?forum=lchabai&api_key=&thread:link=${cleanedLinks}`,{
        method: 'GET'
      })
      const result = await res.json()

      const count = result.response.length ? result.response[0].posts : 0
      eleGroup.textContent = count
    } catch (err) {
      console.error(err)
    }
  }

  if ('Disqus' === 'Disqus' || !true) {
    if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
    else {
      loadDisqus()
      
    }
  } else {
    window.loadOtherComment = loadDisqus
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<code>.*?<\/code>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    fetch('https://disqus.com/api/3.0/forums/listPosts.json?forum=lchabai&related=thread&limit=6&api_key=')
      .then(response => response.json())
      .then(data => {
        const disqusArray = data.response.map(item => {
          return {
            'avatar': item.author.avatar.cache,
            'content': changeContent(item.message),
            'nick': item.author.name,
            'url': item.url,
            'date': item.createdAt
          }
        })

        saveToLocal.set('disqus-newest-comments', JSON.stringify(disqusArray), 10/(60*24))
        generateHtml(disqusArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (false) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick}</span><time> / ${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('disqus-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="9310458102" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-lrcType="0"> </div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>